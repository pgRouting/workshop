<!DOCTYPE html>

<html lang="es" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>5. Ciudades y comunidades sostenibles &#8212; Workshop - FOSS4G 2023 Prizren - Routing with pgRouting</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css?v=4468db6d" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=fa3951f0" />
    <script src="../_static/documentation_options.js?v=20becd35"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/translations.js?v=efdbd0b9"></script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="search" title="Búsqueda" href="../search.html" />
    <link rel="next" title="6. Apéndice: OSGeo Soluciones del taller de ONU - ODS" href="appendix.html" />
    <link rel="prev" title="4. Energía asequible y limpia" href="sdg7-energy.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="../_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          Workshop FOSS4G Prizren</a>
        <span class="navbar-text navbar-version pull-left"><b>2.9</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Chapters <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../general-intro/introduction.html">1. Introducción</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../general-intro/introduction.html#basic">1.1. Básico</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general-intro/introduction.html#advanced">1.2. Avanzado</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general-intro/introduction.html#aknowledments">1.3. Aknowledments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general-intro/introduction.html#become-a-sponsor">1.4. Become a sponsor</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../general-intro/osgeolive.html">2. OSGeoLive Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../general-intro/osgeolive.html#install-virtualbox">2.1. Install VirtualBox.</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general-intro/osgeolive.html#osgeolive-on-a-virtualbox">2.2. OSGeoLive on a VirtualBox</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general-intro/osgeolive.html#ubuntu-installation">2.3. Ubuntu installation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../general-intro/overview.html">3. Software and Data Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../general-intro/overview.html#pgrouting-overview">3.1. pgRouting Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general-intro/overview.html#osm2pgrouting-overview">3.2. osm2pgrouting Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../general-intro/overview.html#openstreetmap-overview">3.3. OpenStreetMap Overview</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../basic/data.html">1. Preparar Datos</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../basic/data.html#prepare-the-database">1.1. Preparar la base de datos</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basic/data.html#get-the-workshop-data">1.2. Obtenga los Datos del Taller</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basic/data.html#upload-data-to-the-database">1.3. Cargar datos en la base de datos</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basic/data.html#chapter-appendix">1.4. Capítulo: Apéndice</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../basic/pedestrian.html">2. Enrutamiento peatonal</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../basic/pedestrian.html#pgr-dijkstra">2.1. pgr_dijkstra</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basic/pedestrian.html#pgr-dijkstracost">2.2. pgr_dijkstraCost</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../basic/vehicle.html">3. Enrutamiento de vehículos</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../basic/vehicle.html#routing-for-vehicles">3.1. Ruteo para vehículos</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basic/vehicle.html#cost-manipulations">3.2. Manipulaciones de costes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../basic/sql_function.html">4. Función SQL</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../basic/sql_function.html#the-application-requirements">4.1. Los requisitos de aplicación</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basic/sql_function.html#preparing-processing-graphs">4.2. Preparación de grafos de procesamiento</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basic/sql_function.html#geometry-handling">4.3. Manejo de geometría</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basic/sql_function.html#creating-the-function">4.4. Crear la función</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../basic/plpgsql_function.html">5. Función pl/pgsql</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../basic/plpgsql_function.html#requirements-for-routing-from-a-to-b">5.1. Requisitos para el ruteo de A a B</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basic/plpgsql_function.html#the-vertex-table">5.2. La Tabla de Vértices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basic/plpgsql_function.html#wrk-fromatob-function">5.3. función wrk_fromAtoB</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../basic/appendix.html">6. Apéndice: Soluciones básicas para el taller</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../basic/appendix.html#solutions-to-pedestrian">6.1. Soluciones a <span class="xref std std-doc">pedestrian</span></a></li>
<li class="toctree-l2"><a class="reference internal" href="../basic/appendix.html#solutions-to-vehicle">6.2. Soluciones a <span class="xref std std-doc">vehicle</span></a></li>
<li class="toctree-l2"><a class="reference internal" href="../basic/appendix.html#solutions-to-sql-function">6.3. Soluciones a <span class="xref std std-doc">sql_function</span></a></li>
<li class="toctree-l2"><a class="reference internal" href="../basic/appendix.html#solutions-to-plpgsql-function">6.4. Soluciones a <span class="xref std std-doc">plpgsql_function</span></a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../advanced/chapter-12.html">1. Crear una topología de red</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../advanced/chapter-12.html#load-network-data">1.1. Cargar los datos de la red</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced/chapter-12.html#create-a-routing-network-topology">1.2. Crear una Topología de Red de Ruteo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced/chapter-12.html#verify-the-routing-network-topology">1.3. Verifique la Topología de Red de Ruteo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced/chapter-12.html#analyze-and-adjust-the-routing-network-topology">1.4. Analizar y ajustar la Topología de Red de Ruteo</a></li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="data.html">1. Datos para los Objetivos de Desarrollo Sostenible</a><ul>
<li class="toctree-l2"><a class="reference internal" href="data.html#work-directory-for-pgrouting-data-manipulation">1.1. Directorio de trabajo para la manipulación de datos de pgRouting</a></li>
<li class="toctree-l2"><a class="reference internal" href="data.html#mumbai-database">1.2. Base de datos de Mumbai</a></li>
<li class="toctree-l2"><a class="reference internal" href="data.html#bangladesh-database">1.3. Base de datos de Bangladesh</a></li>
<li class="toctree-l2"><a class="reference internal" href="data.html#appendix">1.4. Apéndice</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">2. Alcanzar los Objetivos de Desarrollo Sostenible con pgRouting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#history">2.1. Historia</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#united-nations">2.2. Organización de las Naciones Unidas</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#what-are-the-sustainable-development-goals">2.3. ¿Qué son los Objetivos de Desarrollo Sostenible?</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#target-audience">2.4. Público objetivo</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#prerequisites-for-un-sdg-exercises">2.5. Requisitos previos para los ejercicios de los ODS de ONU</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="sdg3-health.html">3. Buena salud y bienestar</a><ul>
<li class="toctree-l2"><a class="reference internal" href="sdg3-health.html#problem-estimation-of-population-served-by-hospitals">3.1. Problema: Estimación de la población atendida por los hospitales</a></li>
<li class="toctree-l2"><a class="reference internal" href="sdg3-health.html#pre-processing-roads-and-buildings-data">3.2. Preprocesamiento de datos de caminos y edificios</a></li>
<li class="toctree-l2"><a class="reference internal" href="sdg3-health.html#finding-the-roads-served-by-the-hospitals">3.3. Encontrar los caminos atendidos por los hospitales</a></li>
<li class="toctree-l2"><a class="reference internal" href="sdg3-health.html#calculating-the-total-population-served-by-the-hospital">3.4. Cálculo de la población total atendida por el hospital</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="sdg7-energy.html">4. Energía asequible y limpia</a><ul>
<li class="toctree-l2"><a class="reference internal" href="sdg7-energy.html#problem-optimising-the-electricity-distribution-network">4.1. Problema: Optimización de la red de distribución eléctrica</a></li>
<li class="toctree-l2"><a class="reference internal" href="sdg7-energy.html#pre-processing-roads-data">4.2. Preprocesamiento de datos de carreteras</a></li>
<li class="toctree-l2"><a class="reference internal" href="sdg7-energy.html#pgr-connectedcomponents-for-preprocessing-roads">4.3. <code class="docutils literal notranslate"><span class="pre">pgr_connectedComponents</span></code> para el preprocesamiento de carreteras</a></li>
<li class="toctree-l2"><a class="reference internal" href="sdg7-energy.html#extract-connected-components-of-roads">4.4. Extraer componentes conectados de carreteras</a></li>
<li class="toctree-l2"><a class="reference internal" href="sdg7-energy.html#pgr-kruskaldfs">4.5. pgr_kruskalDFS</a></li>
<li class="toctree-l2"><a class="reference internal" href="sdg7-energy.html#exercise-10-find-the-minimum-spanning-tree">4.6. Ejercicio 10: Encontrar el árbol de expansión mínimo</a></li>
<li class="toctree-l2"><a class="reference internal" href="sdg7-energy.html#comparison-between-total-and-optimal-lengths">4.7. Comparación entre longitudes totales y óptimas</a></li>
<li class="toctree-l2"><a class="reference internal" href="sdg7-energy.html#further-possible-extensions-to-the-exercise">4.8. Otras posibles extensiones al ejercicio</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">5. Ciudades y comunidades sostenibles</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#problem-city-getting-affected-by-rain-or-not">5.1. Problema: Ciudad afectada por la lluvia o no</a></li>
<li class="toctree-l2"><a class="reference internal" href="#choose-a-city">5.2. Eligir una ciudad</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pre-processing-waterways-data">5.3. Preprocesamiento de datos de vías navegables</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pgr-connectedcomponents-for-preprocessing-waterways">5.4. <code class="docutils literal notranslate"><span class="pre">pgr_connectedComponents</span></code> para el preprocesamiento de vías navegables</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exercise-8-get-the-connected-components-of-waterways">5.5. Ejercicio 8: Obtener los componentes conectados de las vías fluviales</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exercise-9-creating-buffer-around-the-city">5.6. Ejercicio 9: Crear una zona límite alrededor de la ciudad</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exercise-11-finding-the-components-intersecting-the-buffer">5.7. Ejercicio 11: Encontrar los componentes que intersectan la zona limitada</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exercise-12-get-the-rain-zones">5.8. Ejercicio 12: Obtener las zonas de lluvia</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exercise-13-create-a-union-of-rain-zones">5.9. Ejercicio 13: Crear una unión de zonas de lluvia</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="appendix.html">6. Apéndice: OSGeo Soluciones del taller de ONU - ODS</a><ul>
<li class="toctree-l2"><a class="reference internal" href="appendix.html#solutions-to-chapter-3-sdg3-health">6.1. Soluciones al Capítulo 3: <span class="xref std std-doc">sdg3-health</span></a></li>
<li class="toctree-l2"><a class="reference internal" href="appendix.html#solutions-to-sdg7-energy">6.2. Soluciones para <span class="xref std std-doc">sdg7-energy</span></a></li>
<li class="toctree-l2"><a class="reference internal" href="appendix.html#solutions-to-sdg11-cities">6.3. Soluciones para <span class="xref std std-doc">sdg11-cities</span></a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../interactions/chapter-9.html">1. Uso de Qgis</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../interactions/chapter-9.html#set-up-qgis">1.1. Configurar QGIS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interactions/chapter-9.html#add-a-postgis-layer">1.2. Añadir una Capa postGIS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interactions/chapter-9.html#format-a-routing-layer">1.3. Formatear una Capa de Ruteo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interactions/chapter-9.html#copy-paste-format">1.4. Copiar/Pegar Formato</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interactions/chapter-9.html#save-the-project">1.5. Guardar el proyecto</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../interactions/chapter-10.html">2. Servidor WMS con GeoServer</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../interactions/chapter-10.html#connect-to-the-administration-page">2.1. Conéctese a la página de administración</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interactions/chapter-10.html#create-the-layer">2.2. Crear la capa</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../interactions/chapter-11.html">3. Interfaz de Ruteo Basada en OpenLayers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../interactions/chapter-11.html#openlayers-introduction">3.1. Introducción a OpenLayers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interactions/chapter-11.html#creating-a-minimal-map">3.2. Crear un mapa mínimo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interactions/chapter-11.html#wms-get-parameters">3.3. Parámetros WMS GET</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interactions/chapter-11.html#select-start-and-destination">3.4. Seleccione «inicio» y «destino»</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interactions/chapter-11.html#clear-the-results">3.5. Borrar los resultados</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interactions/chapter-11.html#summary-full-example">3.6. Resumen (ejemplo completo)</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../examples/boost_dijkstra.html">1. Ejemplo de Boost Dijkstra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/hanoslav.html">2. Ejemplos del Internet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/wiki_example.html">3. Ejemplo de Wikipedia Dijkstra</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../appendix/appendix-2.html">1. Apéndice: Instalación</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/appendix-3.html">2. Apéndice: Herramienta de Importación osm2pgrouting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/appendix-4.html">3. Tutoriales en Video para Taller</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../appendix/appendix-4.html#chapter-4">3.1. Capítulo 4</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">5. Ciudades y comunidades sostenibles</a><ul>
<li><a class="reference internal" href="#problem-city-getting-affected-by-rain-or-not">5.1. Problema: Ciudad afectada por la lluvia o no</a></li>
<li><a class="reference internal" href="#choose-a-city">5.2. Eligir una ciudad</a><ul>
<li><a class="reference internal" href="#exercise-1-create-a-point-for-the-city">5.2.1. Ejercicio 1: Crear un punto para la ciudad</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pre-processing-waterways-data">5.3. Preprocesamiento de datos de vías navegables</a><ul>
<li><a class="reference internal" href="#setting-the-search-path-of-waterways">5.3.1. Establecer la ruta de búsqueda de las vías fluviales</a><ul>
<li><a class="reference internal" href="#exercise-2-inspecting-the-schemas">5.3.1.1. Ejercicio 2: Inspección de los esquemas</a></li>
<li><a class="reference internal" href="#exercise-3-inspecting-the-search-path">5.3.1.2. Ejercicio 3: Inspeccionar la ruta de búsqueda</a></li>
<li><a class="reference internal" href="#exercise-4-fixing-the-search-path">5.3.1.3. Ejercicio 4: Arreglar la ruta de búsqueda</a></li>
<li><a class="reference internal" href="#exercise-5-enumerating-tables">5.3.1.4. Ejercicio 5: Enumerar tablas</a></li>
<li><a class="reference internal" href="#exercise-6-counting-the-number-of-waterways">5.3.1.5. Ejercicio 6: Contar el número de vías navegables</a></li>
</ul>
</li>
<li><a class="reference internal" href="#exercise-7-removing-the-rivers-which-are-in-swamps">5.3.2. Ejercicio 7: Eliminar los ríos que están en pantanos</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pgr-connectedcomponents-for-preprocessing-waterways">5.4. <code class="docutils literal notranslate"><span class="pre">pgr_connectedComponents</span></code> para el preprocesamiento de vías navegables</a></li>
<li><a class="reference internal" href="#exercise-8-get-the-connected-components-of-waterways">5.5. Ejercicio 8: Obtener los componentes conectados de las vías fluviales</a></li>
<li><a class="reference internal" href="#exercise-9-creating-buffer-around-the-city">5.6. Ejercicio 9: Crear una zona límite alrededor de la ciudad</a><ul>
<li><a class="reference internal" href="#exercise-10-creating-a-function-that-gets-the-city-buffer">5.6.1. Ejercicio 10: Crear una función que obtenga la zona límite de la ciudad</a></li>
</ul>
</li>
<li><a class="reference internal" href="#exercise-11-finding-the-components-intersecting-the-buffer">5.7. Ejercicio 11: Encontrar los componentes que intersectan la zona limitada</a></li>
<li><a class="reference internal" href="#exercise-12-get-the-rain-zones">5.8. Ejercicio 12: Obtener las zonas de lluvia</a></li>
<li><a class="reference internal" href="#exercise-13-create-a-union-of-rain-zones">5.9. Ejercicio 13: Crear una unión de zonas de lluvia</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="sdg7-energy.html" title="Previous Chapter: 4. Energía asequible y limpia"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; 4. Energía as...</span>
    </a>
  </li>
  <li>
    <a href="appendix.html" title="Next Chapter: 6. Apéndice: OSGeo Soluciones del taller de ONU - ODS"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">6. Apéndice: ... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <section id="sustainable-cities-and-communities">
<h1><a class="toc-backref" href="#id1" role="doc-backlink"><span class="section-number">5. </span>Ciudades y comunidades sostenibles</a><a class="headerlink" href="#sustainable-cities-and-communities" title="Link to this heading">¶</a></h1>
<p>“Ciudades y Comunidades Sostenibles” es el 11º Objetivo de Desarrollo Sostenible que aspira a hacer que las ciudades sean «inclusivas, seguras, resilientes» y «sostenibles». El mundo se está urbanizando cada vez más. Desde 2007, más de la mitad de la población mundial vive en ciudades. Esto hace que sea muy importante que las ciudades permanezcan alertas cuando existe la posibilidad de desastres como inundaciones. La administración local debe saber si su ciudad se va a ver afectada por las lluvias que ocurren en sus proximidades para que puedan alertar a los ciudadanos. Este ejercicio resolverá uno de estos problemas.</p>
<img alt="Objetivo de Desarrollo Sostenible 11: Ciudades y Comunidades Sostenibles" class="align-center" src="../_images/un_sdg11.png" />
<p>“Fuente de la imagen &lt;<a class="reference external" href="https://sdgs.un.org/goals/goal11">https://sdgs.un.org/goals/goal11</a>&gt;`__</p>
<nav class="contents" id="chapter-contents">
<p class="topic-title">Contenido del Capítulo</p>
<ul class="simple">
<li><p><a class="reference internal" href="#sustainable-cities-and-communities" id="id1">Ciudades y comunidades sostenibles</a></p>
<ul>
<li><p><a class="reference internal" href="#problem-city-getting-affected-by-rain-or-not" id="id2">Problema: Ciudad afectada por la lluvia o no</a></p></li>
<li><p><a class="reference internal" href="#choose-a-city" id="id3">Eligir una ciudad</a></p>
<ul>
<li><p><a class="reference internal" href="#exercise-1-create-a-point-for-the-city" id="id4">Ejercicio 1: Crear un punto para la ciudad</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#pre-processing-waterways-data" id="id5">Preprocesamiento de datos de vías navegables</a></p>
<ul>
<li><p><a class="reference internal" href="#setting-the-search-path-of-waterways" id="id6">Establecer la ruta de búsqueda de las vías fluviales</a></p>
<ul>
<li><p><a class="reference internal" href="#exercise-2-inspecting-the-schemas" id="id7">Ejercicio 2: Inspección de los esquemas</a></p></li>
<li><p><a class="reference internal" href="#exercise-3-inspecting-the-search-path" id="id8">Ejercicio 3: Inspeccionar la ruta de búsqueda</a></p></li>
<li><p><a class="reference internal" href="#exercise-4-fixing-the-search-path" id="id9">Ejercicio 4: Arreglar la ruta de búsqueda</a></p></li>
<li><p><a class="reference internal" href="#exercise-5-enumerating-tables" id="id10">Ejercicio 5: Enumerar tablas</a></p></li>
<li><p><a class="reference internal" href="#exercise-6-counting-the-number-of-waterways" id="id11">Ejercicio 6: Contar el número de vías navegables</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#exercise-7-removing-the-rivers-which-are-in-swamps" id="id12">Ejercicio 7: Eliminar los ríos que están en pantanos</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#pgr-connectedcomponents-for-preprocessing-waterways" id="id13"><code class="docutils literal notranslate"><span class="pre">pgr_connectedComponents</span></code> para el preprocesamiento de vías navegables</a></p></li>
<li><p><a class="reference internal" href="#exercise-8-get-the-connected-components-of-waterways" id="id14">Ejercicio 8: Obtener los componentes conectados de las vías fluviales</a></p></li>
<li><p><a class="reference internal" href="#exercise-9-creating-buffer-around-the-city" id="id15">Ejercicio 9: Crear una zona límite alrededor de la ciudad</a></p>
<ul>
<li><p><a class="reference internal" href="#exercise-10-creating-a-function-that-gets-the-city-buffer" id="id16">Ejercicio 10: Crear una función que obtenga la zona límite de la ciudad</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#exercise-11-finding-the-components-intersecting-the-buffer" id="id17">Ejercicio 11: Encontrar los componentes que intersectan la zona limitada</a></p></li>
<li><p><a class="reference internal" href="#exercise-12-get-the-rain-zones" id="id18">Ejercicio 12: Obtener las zonas de lluvia</a></p></li>
<li><p><a class="reference internal" href="#exercise-13-create-a-union-of-rain-zones" id="id19">Ejercicio 13: Crear una unión de zonas de lluvia</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="problem-city-getting-affected-by-rain-or-not">
<h2><a class="toc-backref" href="#id2" role="doc-backlink"><span class="section-number">5.1. </span>Problema: Ciudad afectada por la lluvia o no</a><a class="headerlink" href="#problem-city-getting-affected-by-rain-or-not" title="Link to this heading">¶</a></h2>
<p><strong>Declaración del problema</strong></p>
<p>Determinar las áreas donde si llueve afectará a una ciudad/pueblo</p>
<a class="reference internal image-reference" href="../_images/sdg11_output.png"><img alt="../_images/sdg11_output.png" class="align-center" src="../_images/sdg11_output.png" style="width: 413.5px; height: 254.0px;" /></a>
<p><strong>Idea central</strong></p>
<p>Si llueve en las cercanías de un río que conecta la ciudad, la ciudad se verá afectada por las lluvias.</p>
<p><strong>Enfoque</strong></p>
<ul class="simple">
<li><p>Eligir una ciudad</p></li>
<li><p>Obtener los ríos (segmentos)</p></li>
<li><p>Crear componentes fluviales</p></li>
<li><p>Crear una zona límite alrededor de la ciudad</p></li>
<li><p>Encontrar los componentes que intersectan la zona limitada</p></li>
<li><p>Encontrar las zonas de lluvia</p></li>
</ul>
</section>
<section id="choose-a-city">
<h2><a class="toc-backref" href="#id3" role="doc-backlink"><span class="section-number">5.2. </span>Eligir una ciudad</a><a class="headerlink" href="#choose-a-city" title="Link to this heading">¶</a></h2>
<p>Para este ejercicio, se elige la ciudad de Munshigang de Bangladesh. Esta ciudad tiene múltiples ríos en su proximidad, lo que la convierte en un lugar adecuado para demostrar este ejercicio. El ejercicio tratará de encontrar las zonas, donde si llueve la ciudad se verá afectada. Para definir la ubicación de esta ciudad y usarla en pasos posteriores, crear una tabla para almacenar el nombre junto con los valores de latitud y longitud de la ubicación de la ciudad. Esto almacena la ciudad como un punto.</p>
<section id="exercise-1-create-a-point-for-the-city">
<h3><a class="toc-backref" href="#id4" role="doc-backlink"><span class="section-number">5.2.1. </span>Ejercicio 1: Crear un punto para la ciudad</a><a class="headerlink" href="#exercise-1-create-a-point-for-the-city" title="Link to this heading">¶</a></h3>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">city_vertex</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span><span class="w"> </span><span class="n">geom</span><span class="w"> </span><span class="n">geometry</span><span class="p">);</span>
<span class="linenos">2</span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">city_vertex</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">geom</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span>
<span class="linenos">3</span><span class="mi">5</span><span class="p">,</span><span class="s1">&#39;Munshigang&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">ST_SetSRID</span><span class="p">(</span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">89</span><span class="p">.</span><span class="mi">1967</span><span class="p">,</span><span class="mi">22</span><span class="p">.</span><span class="mi">2675</span><span class="p">),</span><span class="mi">4326</span><span class="p">));</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><a class="reference internal" href="appendix.html#exercise-1-chapter-sdg-11"><span class="std std-ref">Ejercicio: 1 (Capítulo: ODS 11)</span></a></p>
<p>Los valores de latitud y longitud se convierten en <code class="docutils literal notranslate"><span class="pre">geometry</span></code> usando <code class="docutils literal notranslate"><span class="pre">ST_Point</span></code> que devuelve un punto con los valores de coordenadas X e Y dados. <code class="docutils literal notranslate"><span class="pre">ST_SetSRID</span></code> se utiliza para establecer el SRID (Identificado de referencia Espacial) en la geometría del punto en <code class="docutils literal notranslate"><span class="pre">4326</span></code>.</p>
</section>
</section>
<section id="pre-processing-waterways-data">
<h2><a class="toc-backref" href="#id5" role="doc-backlink"><span class="section-number">5.3. </span>Preprocesamiento de datos de vías navegables</a><a class="headerlink" href="#pre-processing-waterways-data" title="Link to this heading">¶</a></h2>
<p>El primer paso es preprocesar los datos obtenidos de <a class="reference internal" href="data.html"><span class="doc">Datos para los Objetivos de Desarrollo Sostenible</span></a>. En esta sección se trabajará el grafo que se va a utilizar para el procesamiento. Mientras se construye el grafo, se deben inspeccionar los datos para determinar si hay datos no válidos. Este es un paso muy importante para garantizar que los datos tengan la calidad requerida. pgRouting también se puede utilizar para realizar algunos ajustes de datos. Esto se discutirá en secciones posteriores.</p>
<section id="setting-the-search-path-of-waterways">
<h3><a class="toc-backref" href="#id6" role="doc-backlink"><span class="section-number">5.3.1. </span>Establecer la ruta de búsqueda de las vías fluviales</a><a class="headerlink" href="#setting-the-search-path-of-waterways" title="Link to this heading">¶</a></h3>
<p>El primer paso en el preprocesamiento es establecer la ruta de búsqueda para los datos de <code class="docutils literal notranslate"><span class="pre">Waterways</span></code>. La ruta de búsqueda es una lista de esquemas que ayuda al sistema a determinar cómo se va a importar una tabla en particular.</p>
<section id="exercise-2-inspecting-the-schemas">
<h4><a class="toc-backref" href="#id7" role="doc-backlink"><span class="section-number">5.3.1.1. </span>Ejercicio 2: Inspección de los esquemas</a><a class="headerlink" href="#exercise-2-inspecting-the-schemas" title="Link to this heading">¶</a></h4>
<p>Inspeccione los esquemas mostrando todos los esquemas actuales mediante el siguiente comando</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="se">\d</span>n
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="w">   </span>List<span class="w"> </span>of<span class="w"> </span>schemas
<span class="w">   </span>Name<span class="w">    </span><span class="p">|</span><span class="w">  </span>Owner
-----------+----------
<span class="w"> </span>public<span class="w">    </span><span class="p">|</span><span class="w"> </span>postgres
<span class="w"> </span>waterway<span class="w">  </span><span class="p">|</span><span class="w"> </span>&lt;user-name&gt;
<span class="o">(</span><span class="m">2</span><span class="w"> </span>rows<span class="o">)</span>
</pre></div>
</div>
<p>Los nombres de esquema son <cite>waterway`</cite> and <code class="docutils literal notranslate"><span class="pre">public</span></code>. El propietario depende de quién tenga los derechos de la base de datos.</p>
</section>
<section id="exercise-3-inspecting-the-search-path">
<h4><a class="toc-backref" href="#id8" role="doc-backlink"><span class="section-number">5.3.1.2. </span>Ejercicio 3: Inspeccionar la ruta de búsqueda</a><a class="headerlink" href="#exercise-3-inspecting-the-search-path" title="Link to this heading">¶</a></h4>
<p>Mostrar la ruta de búsqueda actual mediante la siguiente consulta.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>SHOW<span class="w"> </span>search_path<span class="p">;</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="w">   </span>search_path
-----------------
<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$user</span><span class="s2">&quot;</span>,<span class="w"> </span>public
<span class="o">(</span><span class="m">1</span><span class="w"> </span>row<span class="o">)</span>
</pre></div>
</div>
<p>Esta es la ruta de búsqueda actual. No se puede acceder a las tablas mediante esta opción.</p>
</section>
<section id="exercise-4-fixing-the-search-path">
<h4><a class="toc-backref" href="#id9" role="doc-backlink"><span class="section-number">5.3.1.3. </span>Ejercicio 4: Arreglar la ruta de búsqueda</a><a class="headerlink" href="#exercise-4-fixing-the-search-path" title="Link to this heading">¶</a></h4>
<p>En este caso, la ruta de búsqueda de la tabla de carreteras se establece en el esquema <code class="docutils literal notranslate"><span class="pre">waterways</span></code> . La siguiente consulta se utiliza para corregir la ruta de búsqueda</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>SET<span class="w"> </span>search_path<span class="w"> </span>TO<span class="w"> </span>waterways,public<span class="p">;</span>
SHOW<span class="w"> </span>search_path<span class="p">;</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="w">    </span>search_path
-------------------
<span class="w"> </span>waterways,<span class="w"> </span>public
<span class="o">(</span><span class="m">1</span><span class="w"> </span>row<span class="o">)</span>
</pre></div>
</div>
</section>
<section id="exercise-5-enumerating-tables">
<h4><a class="toc-backref" href="#id10" role="doc-backlink"><span class="section-number">5.3.1.4. </span>Ejercicio 5: Enumerar tablas</a><a class="headerlink" href="#exercise-5-enumerating-tables" title="Link to this heading">¶</a></h4>
<p>Finalmente, <cite>dt`</cite> se utiliza para verificar si el esquema se ha cambiado correctamente.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="se">\d</span>t
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="w">                     </span>List<span class="w"> </span>of<span class="w"> </span>relations
<span class="w">  </span>Schema<span class="w">   </span><span class="p">|</span><span class="w">            </span>Name<span class="w">             </span><span class="p">|</span><span class="w"> </span>Type<span class="w">  </span><span class="p">|</span><span class="w">  </span>Owner
-----------+-----------------------------+-------+---------
<span class="w"> </span>public<span class="w">    </span><span class="p">|</span><span class="w"> </span>spatial_ref_sys<span class="w">             </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>&lt;user-name&gt;
<span class="w"> </span>waterways<span class="w"> </span><span class="p">|</span><span class="w"> </span>configuration<span class="w">               </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>user
<span class="w"> </span>waterways<span class="w"> </span><span class="p">|</span><span class="w"> </span>waterways_pointsofinterest<span class="w">  </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>user
<span class="w"> </span>waterways<span class="w"> </span><span class="p">|</span><span class="w"> </span>waterways_ways<span class="w">              </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>user
<span class="w"> </span>waterways<span class="w"> </span><span class="p">|</span><span class="w"> </span>waterways_ways_vertices_pgr<span class="w"> </span><span class="p">|</span><span class="w"> </span>table<span class="w"> </span><span class="p">|</span><span class="w"> </span>user
<span class="o">(</span><span class="m">5</span><span class="w"> </span>rows<span class="o">)</span>
</pre></div>
</div>
</section>
<section id="exercise-6-counting-the-number-of-waterways">
<h4><a class="toc-backref" href="#id11" role="doc-backlink"><span class="section-number">5.3.1.5. </span>Ejercicio 6: Contar el número de vías navegables</a><a class="headerlink" href="#exercise-6-counting-the-number-of-waterways" title="Link to this heading">¶</a></h4>
<p>La importancia de contar la información en este taller es asegurarse de que se utilizan los mismos datos y, en consecuencia, los resultados son los mismos. Además, algunas de las filas se pueden ver para comprender la estructura de la tabla y cómo se almacenan los datos en ella.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">SELECT</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">waterways_ways</span><span class="p">;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><a class="reference internal" href="appendix.html#exercise-6-chapter-sdg-11"><span class="std std-ref">Ejercicio: 6 (Capítulo: ODS 11)</span></a></p>
</section>
</section>
<section id="exercise-7-removing-the-rivers-which-are-in-swamps">
<h3><a class="toc-backref" href="#id12" role="doc-backlink"><span class="section-number">5.3.2. </span>Ejercicio 7: Eliminar los ríos que están en pantanos</a><a class="headerlink" href="#exercise-7-removing-the-rivers-which-are-in-swamps" title="Link to this heading">¶</a></h3>
<p>Este ejercicio se centra solo en las zonas del continente, donde si llueve la ciudad se ve afectada. Por lo tanto, los ríos que están allí en el área del pantano tienen que ser eliminados de la tabla <code class="docutils literal notranslate"><span class="pre">waterways_ways</span></code> .</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">waterways_ways</span><span class="w"> </span>
<span class="linenos">2</span><span class="k">WHERE</span><span class="w"> </span><span class="n">osm_id</span><span class="w"> </span>
<span class="linenos">3</span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="mi">721133202</span><span class="p">,</span><span class="w"> </span><span class="mi">908102930</span><span class="p">,</span><span class="w"> </span><span class="mi">749173392</span><span class="p">,</span><span class="w"> </span><span class="mi">652172284</span><span class="p">,</span><span class="w"> </span><span class="mi">126774195</span><span class="p">,</span><span class="w"> </span><span class="mi">720395312</span><span class="p">);</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><a class="reference internal" href="appendix.html#exercise-7-chapter-sdg-11"><span class="std std-ref">Ejercicio: 7 (Capítulo: ODS 11)</span></a></p>
</section>
</section>
<section id="pgr-connectedcomponents-for-preprocessing-waterways">
<h2><a class="toc-backref" href="#id13" role="doc-backlink"><span class="section-number">5.4. </span><code class="docutils literal notranslate"><span class="pre">pgr_connectedComponents</span></code> para el preprocesamiento de vías navegables</a><a class="headerlink" href="#pgr-connectedcomponents-for-preprocessing-waterways" title="Link to this heading">¶</a></h2>
<p>Para el siguiente paso se utilizará <code class="docutils literal notranslate"><span class="pre">pgr_connectedComponents</span></code>. Se utiliza para encontrar los componentes conectados de un grafo no dirigido utilizando un enfoque basado en la búsqueda en profundidad.</p>
<p class="rubric">Firmas</p>
<div class="highlight-none notranslate" id="index-0"><div class="highlight"><pre><span></span>pgr_connectedComponents(edges_sql)

RETURNS SET OF (seq, component, node)
OR EMPTY SET
</pre></div>
</div>
<p>Para más información la documentation de <a class="reference external" href="https://docs.pgrouting.org/3.1/en/pgr_connectedComponents.html">pgr_connectedComponents</a> puede se emcotrada en esta liga..</p>
</section>
<section id="exercise-8-get-the-connected-components-of-waterways">
<h2><a class="toc-backref" href="#id14" role="doc-backlink"><span class="section-number">5.5. </span>Ejercicio 8: Obtener los componentes conectados de las vías fluviales</a><a class="headerlink" href="#exercise-8-get-the-connected-components-of-waterways" title="Link to this heading">¶</a></h2>
<p>Como los ríos en los datos no tienen un solo segmento, es decir, múltiples segmentos forman un río, es importante encontrar los segmentos conectados y almacenar la información en la tabla <code class="docutils literal notranslate"><span class="pre">waterways_ways</span></code>. Esto ayudará a identificar cuáles segmentos pertenecen a un río. Primero se encuentran los componentes conectados y luego se almacenan en una nueva columna llamada <code class="docutils literal notranslate"><span class="pre">component</span></code>.</p>
<p>La función pgRouting <code class="docutils literal notranslate"><span class="pre">pgr_connectedComponents</span></code> se utiliza para completar esta tarea. Se crea una subconsulta para averiguar todos los componentes conectados. Después de eso, la columna <code class="docutils literal notranslate"><span class="pre">component</span></code> se actualiza utilizando los resultados obtenidos de la subconsulta. Esto ayuda a almacenar el identificador del componente en la tabla <code class="docutils literal notranslate"><span class="pre">waterways_ways_vertices_pgr</span></code>. La siguiente consulta utiliza este resultado y almacena el identificador del componente en la tabla <code class="docutils literal notranslate"><span class="pre">waterways_ways</span></code> (bordes). Siga los pasos que se indican a continuación para completar esta tarea.</p>
<ol class="arabic simple">
<li><p>Agregue una columna denominada “<code class="docutils literal notranslate"><span class="pre">component</span></code> para almacenar el número de componente.</p></li>
</ol>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">waterways_ways_vertices_pgr</span>
<span class="linenos">2</span><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">;</span>
<span class="linenos">3</span>
<span class="linenos">4</span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">waterways_ways</span>
<span class="linenos">5</span><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">;</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Obtener los componentes conectados de las vías fluviales</p></li>
</ol>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">UPDATE</span><span class="w"> </span><span class="n">waterways_ways_vertices_pgr</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subquery</span><span class="p">.</span><span class="n">component</span>
<span class="linenos"> 2</span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">pgr_connectedComponents</span><span class="p">(</span>
<span class="linenos"> 3</span><span class="s1">&#39;SELECT gid AS id, source, target, cost, reverse_cost FROM waterways_ways&#39;</span><span class="p">)</span>
<span class="linenos"> 4</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">subquery</span>
<span class="linenos"> 5</span><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="p">;</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="k">UPDATE</span><span class="w"> </span><span class="n">waterways_ways</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">component</span><span class="o">=</span><span class="n">a</span><span class="p">.</span><span class="n">component</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span>
<span class="linenos"> 8</span><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">waterways_ways_vertices_pgr</span>
<span class="linenos"> 9</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">a</span><span class="w">  </span>
<span class="linenos">10</span><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">source</span><span class="p">;</span>
</pre></div>
</div>
<p>Con el identificador del componente almacenado tanto en elas tablas de vertices y de segmentos de las vías fluviales, se procede al siguiente paso.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><a class="reference internal" href="appendix.html#exercise-8-chapter-sdg-11"><span class="std std-ref">Ejercicio: 8 (Capítulo: ODS 11)</span></a></p>
</section>
<section id="exercise-9-creating-buffer-around-the-city">
<h2><a class="toc-backref" href="#id15" role="doc-backlink"><span class="section-number">5.6. </span>Ejercicio 9: Crear una zona límite alrededor de la ciudad</a><a class="headerlink" href="#exercise-9-creating-buffer-around-the-city" title="Link to this heading">¶</a></h2>
<p>Crear una zona límite alrededor de la ciudad para definir un área, dentro de la cual se encontraría la intersección de los ríos. <code class="docutils literal notranslate"><span class="pre">ST_Buffer</span></code> se utiliza para crear este búfer. Siga los pasos que se indican a continuación para completar esta tarea.</p>
<ol class="arabic simple">
<li><p>Agregar columna para almacenar la geometría de zona límite</p></li>
</ol>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">waterways</span><span class="p">.</span><span class="n">city_vertex</span>
<span class="linenos">2</span><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">city_buffer</span><span class="w"> </span><span class="n">geometry</span><span class="p">;</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Almacenamiento de la geometría de zona límite</p></li>
</ol>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">UPDATE</span><span class="w"> </span><span class="n">waterways</span><span class="p">.</span><span class="n">city_vertex</span><span class="w"> </span>
<span class="linenos">2</span><span class="k">SET</span><span class="w"> </span><span class="n">city_buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ST_Buffer</span><span class="p">((</span><span class="n">geom</span><span class="p">),</span><span class="mi">0</span><span class="p">.</span><span class="mi">005</span><span class="p">)</span><span class="w"> </span>
<span class="linenos">3</span><span class="k">WHERE</span><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Munshigang&#39;</span><span class="p">;</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Visualización de los resultados de la operación de búfer</p></li>
</ol>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">SELECT</span><span class="w"> </span><span class="n">city_buffer</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">waterways</span><span class="p">.</span><span class="n">city_vertex</span><span class="p">;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><a class="reference internal" href="appendix.html#exercise-9-chapter-sdg-11"><span class="std std-ref">Ejercicio: 9 (Capítulo: ODS 11)</span></a></p>
<section id="exercise-10-creating-a-function-that-gets-the-city-buffer">
<h3><a class="toc-backref" href="#id16" role="doc-backlink"><span class="section-number">5.6.1. </span>Ejercicio 10: Crear una función que obtenga la zona límite de la ciudad</a><a class="headerlink" href="#exercise-10-creating-a-function-that-gets-the-city-buffer" title="Link to this heading">¶</a></h3>
<p>Se puede crear una función para la misma tarea. Esto será de ayuda cuando la tabla tenga más de una ciudad.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>CREATE OR REPLACE FUNCTION get_city_buffer(city_id INTEGER)
<span class="linenos">2</span>RETURNS geometry AS
<span class="linenos">3</span>$BODY$                                                                         
<span class="linenos">4</span>SELECT city_buffer FROM city_vertex WHERE id = city_id;
<span class="linenos">5</span>$BODY$
<span class="linenos">6</span>LANGUAGE SQL;
</pre></div>
</div>
</section>
</section>
<section id="exercise-11-finding-the-components-intersecting-the-buffer">
<h2><a class="toc-backref" href="#id17" role="doc-backlink"><span class="section-number">5.7. </span>Ejercicio 11: Encontrar los componentes que intersectan la zona limitada</a><a class="headerlink" href="#exercise-11-finding-the-components-intersecting-the-buffer" title="Link to this heading">¶</a></h2>
<p>El siguiente paso es encontrar los componentes de las vías fluviales que se encuentran dentro de la zona límite de la ciudad. Estos son los flujos de agua que afectarán a la ciudad cuando llueva a su alrededor. Esto se hace usando <code class="docutils literal notranslate"><span class="pre">ST_Intersects</span></code>. Tenga en cuenta que la función “<code class="docutils literal notranslate"><span class="pre">get_city_buffer</span></code> se utiliza en la consulta a continuación.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">component</span>
<span class="linenos">2</span><span class="k">FROM</span><span class="w"> </span><span class="n">waterways</span><span class="p">.</span><span class="n">city_vertex</span><span class="p">,</span><span class="w"> </span><span class="n">waterways</span><span class="p">.</span><span class="n">waterways_ways</span>
<span class="linenos">3</span><span class="k">WHERE</span><span class="w"> </span><span class="n">ST_Intersects</span><span class="p">(</span><span class="n">the_geom</span><span class="p">,</span><span class="w"> </span><span class="n">get_city_buffer</span><span class="p">(</span><span class="mi">5</span><span class="p">));</span>
</pre></div>
</div>
<p>Los resultados muestran los distintos números de componentes que se encuentran dentro de la zona límite de la ciudad. El siguiente paso es obtener todos los bordes que tienen esos componentes.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><a class="reference internal" href="appendix.html#exercise-11-chapter-sdg-11"><span class="std std-ref">Ejercicio: 11 (Capítulo: ODS 11)</span></a></p>
</section>
<section id="exercise-12-get-the-rain-zones">
<h2><a class="toc-backref" href="#id18" role="doc-backlink"><span class="section-number">5.8. </span>Ejercicio 12: Obtener las zonas de lluvia</a><a class="headerlink" href="#exercise-12-get-the-rain-zones" title="Link to this heading">¶</a></h2>
<p>Este es el paso final del ejercicio. En esta, se está encontrando la zona donde si llueve, la ciudad se vería afectada, también se puede llamar como “”zona de lluvia””. Para esto, crear una zona límite alrededor de los componentes del río. Primero, agregue columnas llamadas <code class="docutils literal notranslate"><span class="pre">rain_zone</span></code> en <code class="docutils literal notranslate"><span class="pre">waterways_ways</span></code> para almacenar la geometría de las zonas de lluvia. Luego, buscar la zona para cada segmento que intersecta el área de la zona límite <code class="docutils literal notranslate"><span class="pre">ST_Buffer</span></code> y actualizar la columna <code class="docutils literal notranslate"><span class="pre">rain_zone</span></code>. Siguir los pasos que se indican a continuación para completar esta tarea.</p>
<ol class="arabic simple">
<li><p>Agregar columna para almacenar la geometría de zona límite</p></li>
</ol>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">waterways_ways</span>
<span class="linenos">2</span><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">rain_zone</span><span class="w"> </span><span class="n">geometry</span><span class="p">;</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Almacenamiento de la geometría de zona límite</p></li>
</ol>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">UPDATE</span><span class="w"> </span><span class="n">waterways</span><span class="p">.</span><span class="n">waterways_ways</span><span class="w"> </span>
<span class="linenos">2</span><span class="k">SET</span><span class="w"> </span><span class="n">rain_zone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ST_Buffer</span><span class="p">((</span><span class="n">the_geom</span><span class="p">),</span><span class="mi">0</span><span class="p">.</span><span class="mi">005</span><span class="p">)</span><span class="w"> </span>
<span class="linenos">3</span><span class="k">WHERE</span><span class="w"> </span><span class="n">ST_Intersects</span><span class="p">(</span><span class="n">the_geom</span><span class="p">,</span><span class="w"> </span><span class="n">get_city_buffer</span><span class="p">(</span><span class="mi">5</span><span class="p">));</span>
</pre></div>
</div>
<p>Esto nos dará la zona requerida, donde si llueve, la ciudad se verá afectada.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><a class="reference internal" href="appendix.html#exercise-12-chapter-sdg-11"><span class="std std-ref">Ejercicio: 12 (Capítulo: ODS 11)</span></a></p>
</section>
<section id="exercise-13-create-a-union-of-rain-zones">
<h2><a class="toc-backref" href="#id19" role="doc-backlink"><span class="section-number">5.9. </span>Ejercicio 13: Crear una unión de zonas de lluvia</a><a class="headerlink" href="#exercise-13-create-a-union-of-rain-zones" title="Link to this heading">¶</a></h2>
<p>Los polígonos múltiples que se obtienen también se pueden fusionar usando “<code class="docutils literal notranslate"><span class="pre">ST_Union</span></code>. Esto dará un solo polígono como salida.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">SELECT</span><span class="w"> </span><span class="n">ST_Union</span><span class="p">(</span><span class="n">rain_zone</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Combined_Rain_Zone</span>
<span class="linenos">2</span><span class="k">FROM</span><span class="w"> </span><span class="n">waterways_ways</span><span class="p">;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><a class="reference internal" href="appendix.html#exercise-13-chapter-sdg-11"><span class="std std-ref">Ejercicio: 13 (Capítulo: ODS 11)</span></a></p>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2010-2023 pgRouting Developers.<br/>
      Actualizado por última vez en mar 30, 2024.<br/>
    </p>
  </div>
</footer>
  </body>
</html>