<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>4. Graph views &#8212; Workshop - FOSS4G Belém - Routing with pgRouting</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css?v=5a695559" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx_collapse.css?v=226d88b4" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=fa3951f0" />
    <script src="../_static/documentation_options.js?v=2015ca06"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="5. SQL function" href="sql_function.html" />
    <link rel="prev" title="3. Vehicle Routing" href="vehicle.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="../_static/bootstrap-2.3.2/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>

  </head><body>

  <div id="navbar" class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>

        <a class="brand" href="../index.html">
          Workshop FOSS4G Belém</a>
        <span class="navbar-text pull-left"><b>3.0</b></span>

        <div class="nav-collapse">
          <ul class="nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://docs.pgrouting.org/latest/en/index.html">Documentation</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Chapters <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../general-intro/introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general-intro/osgeolive.html">2. OSGeoLive Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general-intro/overview.html">3. Software and Data Overview</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="data.html">1. Prepare Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="pedestrian.html">2. Pedestrian Routing</a></li>
<li class="toctree-l1"><a class="reference internal" href="vehicle.html">3. Vehicle Routing</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">4. Graph views</a></li>
<li class="toctree-l1"><a class="reference internal" href="sql_function.html">5. SQL function</a></li>
<li class="toctree-l1"><a class="reference internal" href="plpgsql_function.html">6. pl/pgsql function</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../un_sdg/data.html">1. Data for Sustainable Development Goals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../un_sdg/introduction.html">2. Achieving Sustainable Development Goals with pgRouting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../un_sdg/sdg3-health.html">3. Good Health and Well Being</a></li>
<li class="toctree-l1"><a class="reference internal" href="../un_sdg/sdg7-energy.html">4. Affordable and Clean Energy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../un_sdg/sdg11-cities.html">5. Sustainable Cities and Communities</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../interactions/chapter-9.html">1. Using Qgis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interactions/chapter-10.html">2. WMS server with GeoServer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interactions/chapter-11.html">3. OpenLayers Based Routing Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/chapter-12.html">4. Create a Network Topology</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../examples/boost_dijkstra.html">1. Boost Dijkstra Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/hanoslav.html">2. Internet Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/wiki_example.html">3. Wikipedia Dijkstra Example</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../appendix/appendix-2.html">1. Appendix: Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/appendix-3.html">2. Appendix: osm2pgrouting Import Tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/appendix-4.html">3. Video Tutorials for Workshop</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">4. Graph views</a><ul>
<li><a class="reference internal" href="#the-graph-requirements">4.1. The graph requirements</a></li>
<li><a class="reference internal" href="#pgr-extractvertices">4.2. pgr_extractVertices</a><ul>
<li><a class="reference internal" href="#exercise-1-create-a-vertices-table">4.2.1. Exercise 1: Create a vertices table</a></li>
<li><a class="reference internal" href="#exercise-2-fill-up-other-columns-in-the-vertices-table">4.2.2. Exercise 2: Fill up other columns in the vertices table</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pgr-connectedcomponents">4.3. pgr_connectedComponents</a><ul>
<li><a class="reference internal" href="#exercise-3-set-components-on-edges-and-vertices-tables">4.3.1. Exercise 3: Set components on edges and vertices tables</a></li>
<li><a class="reference internal" href="#exercise-4-inspect-the-components">4.3.2. Exercise 4: Inspect the components</a></li>
</ul>
</li>
<li><a class="reference internal" href="#preparing-the-graphs">4.4. Preparing the graphs</a><ul>
<li><a class="reference internal" href="#exercise-5-creating-a-view-for-routing">4.4.1. Exercise 5: Creating a view for routing</a></li>
<li><a class="reference internal" href="#exercise-6-limiting-the-road-network-within-an-area">4.4.2. Exercise 6: Limiting the road network within an area</a></li>
<li><a class="reference internal" href="#exercise-7-creating-a-materialized-view-for-routing-pedestrians">4.4.3. Exercise 7: Creating a materialized view for routing pedestrians</a></li>
<li><a class="reference internal" href="#exercise-8-testing-the-views-for-routing">4.4.4. Exercise 8: Testing the views for routing</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="vehicle.html" title="Previous Chapter: 3. Vehicle Routing"><span class="icon-chevron-left visible-tablet"></span><span class="hidden-sm hidden-tablet">&laquo; 3. Vehicle Routing</span>
    </a>
  </li>
  <li>
    <a href="sql_function.html" title="Next Chapter: 5. SQL function"><span class="icon-chevron-right visible-tablet"></span><span class="hidden-sm hidden-tablet">5. SQL function &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
      </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body span12 content" role="main">
      
  <section id="graph-views">
<h1><a class="toc-backref" href="#id1" role="doc-backlink"><span class="section-number">4. </span>Graph views</a><a class="headerlink" href="#graph-views" title="Link to this heading">¶</a></h1>
<a class="reference internal image-reference" href="../_images/route.png"><img alt="../_images/route.png" class="align-center" src="../_images/route.png" style="width: 333.0px; height: 217.25px;" />
</a>
<nav class="contents" id="chapter-contents">
<p class="topic-title">Chapter Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#graph-views" id="id1">Graph views</a></p>
<ul>
<li><p><a class="reference internal" href="#the-graph-requirements" id="id2">The graph requirements</a></p></li>
<li><p><a class="reference internal" href="#pgr-extractvertices" id="id3">pgr_extractVertices</a></p>
<ul>
<li><p><a class="reference internal" href="#exercise-1-create-a-vertices-table" id="id4">Exercise 1: Create a vertices table</a></p></li>
<li><p><a class="reference internal" href="#exercise-2-fill-up-other-columns-in-the-vertices-table" id="id5">Exercise 2: Fill up other columns in the vertices table</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#pgr-connectedcomponents" id="id6">pgr_connectedComponents</a></p>
<ul>
<li><p><a class="reference internal" href="#exercise-3-set-components-on-edges-and-vertices-tables" id="id7">Exercise 3: Set components on edges and vertices tables</a></p></li>
<li><p><a class="reference internal" href="#exercise-4-inspect-the-components" id="id8">Exercise 4: Inspect the components</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#preparing-the-graphs" id="id9">Preparing the graphs</a></p>
<ul>
<li><p><a class="reference internal" href="#exercise-5-creating-a-view-for-routing" id="id10">Exercise 5: Creating a view for routing</a></p></li>
<li><p><a class="reference internal" href="#exercise-6-limiting-the-road-network-within-an-area" id="id11">Exercise 6: Limiting the road network within an area</a></p></li>
<li><p><a class="reference internal" href="#exercise-7-creating-a-materialized-view-for-routing-pedestrians" id="id12">Exercise 7: Creating a materialized view for routing pedestrians</a></p></li>
<li><p><a class="reference internal" href="#exercise-8-testing-the-views-for-routing" id="id13">Exercise 8: Testing the views for routing</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
<p>Different application require different graphs. This chapter covers how to
discard disconnected segments and different approaches to create graphs.</p>
<section id="the-graph-requirements">
<h2><a class="toc-backref" href="#id2" role="doc-backlink"><span class="section-number">4.1. </span>The graph requirements</a><a class="headerlink" href="#the-graph-requirements" title="Link to this heading">¶</a></h2>
<p>In this chapter there are three graph requirements. It consists on three graphs
based on a <strong>fully connected</strong> graph derived from <code class="docutils literal notranslate"><span class="pre">ways</span></code>: two for different types
of vehicles and one for pedestrian, the source and the target in all of them are
based on the <code class="docutils literal notranslate"><span class="pre">source_osm</span></code> and <code class="docutils literal notranslate"><span class="pre">target_osm</span></code>.</p>
<p>The description of the graphs:</p>
<ul class="simple">
<li><p>Particular vehicle:</p>
<ul>
<li><p>Circulate on the whole Belém area.</p>
<ul>
<li><p>Do not use <cite>steps</cite>, <cite>footway</cite>, <cite>path</cite>, <cite>cycleway</cite>.</p></li>
</ul>
</li>
<li><p>Speed is the default speed from OSM information.</p></li>
</ul>
</li>
<li><p>Taxi vehicle:</p>
<ul>
<li><p>Circulate on a smaller area:</p>
<ul>
<li><p>Bounding box: <code class="docutils literal notranslate"><span class="pre">(-48.52,-1.46,-48.45,-1.41)</span></code></p></li>
<li><p>Do not use <cite>steps</cite>, <cite>footway</cite>, <cite>path</cite>, <cite>cycleway</cite>.</p></li>
</ul>
</li>
<li><p>Speed is 10% slower than that of the particular vehicles.</p></li>
</ul>
</li>
<li><p>Pedestrians:</p>
<ul>
<li><p>Walk on the whole Belém area.</p></li>
<li><p>Can not walk on exclusive vehicle ways</p>
<ul>
<li><p><cite>motorways</cite> and on <cite>primary</cite> segments.</p></li>
</ul>
</li>
<li><p>The speed is <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">mts/sec</span></code>.</p></li>
</ul>
</li>
</ul>
</section>
<section id="pgr-extractvertices">
<h2><a class="toc-backref" href="#id3" role="doc-backlink"><span class="section-number">4.2. </span>pgr_extractVertices</a><a class="headerlink" href="#pgr-extractvertices" title="Link to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">pgr_extractVertices</span></code> compute the connected components of an undirected
graph using a Depth First Search approach. A connected component of an
undirected graph is a set of vertices that are all reachable from each other.</p>
<p class="rubric">Signature summary</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">pgr_extractVertices</span><span class="p">(</span><span class="n">Edges</span><span class="w"> </span><span class="k">SQL</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">dryrun</span><span class="p">])</span>

<span class="k">RETURNS</span><span class="w"> </span><span class="k">SETOF</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">in_edges</span><span class="p">,</span><span class="w"> </span><span class="n">out_edges</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">geom</span><span class="p">)</span>
<span class="k">OR</span><span class="w"> </span><span class="n">EMTPY</span><span class="w"> </span><span class="k">SET</span>
</pre></div>
</div>
<p>Description of the function can be found in <a class="reference external" href="https://docs.pgrouting.org/latest/en/pgr_connectedComponents.html">pgr_extractVertices</a></p>
<section id="exercise-1-create-a-vertices-table">
<h3><a class="toc-backref" href="#id4" role="doc-backlink"><span class="section-number">4.2.1. </span>Exercise 1: Create a vertices table</a><a class="headerlink" href="#exercise-1-create-a-vertices-table" title="Link to this heading">¶</a></h3>
<p class="rubric">Problem</p>
<p>Create the vertices table corresponding to the edges in <code class="docutils literal notranslate"><span class="pre">ways</span></code>.</p>
<p class="rubric">Solution</p>
<ul class="simple">
<li><p>A graph consists of a set of vertices and a set of edges.</p></li>
<li><p>In this case, the <code class="docutils literal notranslate"><span class="pre">ways</span></code> table is a set of edges.</p></li>
<li><p>In order to make use of all the graph functions from pgRouting, it is required
have the set of vertices defined.</p></li>
<li><p>From the requirements, the graph is going to be based on OSM identifiers.</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">ways_vertices</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">pgr_extractVertices</span><span class="p">(</span>
<span class="hll"><span class="w">  </span><span class="s1">&#39;SELECT gid AS id, source_osm AS source, target_osm AS target</span>
</span><span class="s1">  FROM ways ORDER BY id&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="55af09f4-2e0b-4700-9a45-1a498c530c49" name="55af09f4-2e0b-4700-9a45-1a498c530c49" type="checkbox"><label class="sphinx_collapse__label" for="55af09f4-2e0b-4700-9a45-1a498c530c49"><i class="sphinx_collapse__icon"></i>Number of inserted records</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="mi">24229</span>
</pre></div>
</div>
</div>
</div>
<p>Reviewing the description of the vertices table</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">dS</span><span class="o">+</span> <span class="n">ways_vertices</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="435f1215-57c1-46e1-940b-37c12acc5f82" name="435f1215-57c1-46e1-940b-37c12acc5f82" type="checkbox"><label class="sphinx_collapse__label" for="435f1215-57c1-46e1-940b-37c12acc5f82"><i class="sphinx_collapse__icon"></i>Description</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                                            <span class="n">Table</span> <span class="s2">&quot;public.ways_vertices&quot;</span>
  <span class="n">Column</span>   <span class="o">|</span>       <span class="n">Type</span>       <span class="o">|</span> <span class="n">Collation</span> <span class="o">|</span> <span class="n">Nullable</span> <span class="o">|</span> <span class="n">Default</span> <span class="o">|</span> <span class="n">Storage</span>  <span class="o">|</span> <span class="n">Compression</span> <span class="o">|</span> <span class="n">Stats</span> <span class="n">target</span> <span class="o">|</span> <span class="n">Description</span> 
<span class="o">-----------+------------------+-----------+----------+---------+----------+-------------+--------------+-------------</span>
 <span class="nb">id</span>        <span class="o">|</span> <span class="n">bigint</span>           <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
 <span class="n">in_edges</span>  <span class="o">|</span> <span class="n">bigint</span><span class="p">[]</span>         <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">extended</span> <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
 <span class="n">out_edges</span> <span class="o">|</span> <span class="n">bigint</span><span class="p">[]</span>         <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">extended</span> <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
 <span class="n">x</span>         <span class="o">|</span> <span class="n">double</span> <span class="n">precision</span> <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
 <span class="n">y</span>         <span class="o">|</span> <span class="n">double</span> <span class="n">precision</span> <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
 <span class="n">geom</span>      <span class="o">|</span> <span class="n">geometry</span>         <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">main</span>     <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
<span class="n">Access</span> <span class="n">method</span><span class="p">:</span> <span class="n">heap</span>

</pre></div>
</div>
</div>
</div>
<p>Inspecting the information on the vertices table</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">ways_vertices</span><span class="w"> </span><span class="k">Limit</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="fd0daab1-dcc6-4cfa-8f8d-e2085bc6236b" name="fd0daab1-dcc6-4cfa-8f8d-e2085bc6236b" type="checkbox"><label class="sphinx_collapse__label" for="fd0daab1-dcc6-4cfa-8f8d-e2085bc6236b"><i class="sphinx_collapse__icon"></i>Data on table</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>     <span class="nb">id</span>     <span class="o">|</span>   <span class="n">in_edges</span>    <span class="o">|</span>  <span class="n">out_edges</span>   <span class="o">|</span> <span class="n">x</span> <span class="o">|</span> <span class="n">y</span> <span class="o">|</span> <span class="n">geom</span> 
<span class="o">------------+---------------+--------------+---+---+------</span>
  <span class="mi">491423851</span> <span class="o">|</span> <span class="p">{</span><span class="mi">1024</span><span class="p">,</span><span class="mi">1025</span><span class="p">}</span>   <span class="o">|</span> <span class="p">{</span><span class="mi">1026</span><span class="p">,</span><span class="mi">1032</span><span class="p">}</span>  <span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span> 
 <span class="mi">7495793356</span> <span class="o">|</span> <span class="p">{</span><span class="mi">21326</span><span class="p">}</span>       <span class="o">|</span> <span class="p">{</span><span class="mi">1084</span><span class="p">,</span><span class="mi">21328</span><span class="p">}</span> <span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span> 
  <span class="mi">492118490</span> <span class="o">|</span> <span class="p">{</span><span class="mi">2743</span><span class="p">}</span>        <span class="o">|</span> <span class="p">{</span><span class="mi">600</span><span class="p">,</span><span class="mi">20210</span><span class="p">}</span>  <span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span> 
 <span class="mi">3684839574</span> <span class="o">|</span> <span class="p">{</span><span class="mi">12850</span><span class="p">,</span><span class="mi">12851</span><span class="p">}</span> <span class="o">|</span> <span class="p">{</span><span class="mi">2</span><span class="p">}</span>          <span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span> 
 <span class="mi">2614178881</span> <span class="o">|</span> <span class="p">{</span><span class="mi">10612</span><span class="p">}</span>       <span class="o">|</span> <span class="p">{</span><span class="mi">563</span><span class="p">,</span><span class="mi">10620</span><span class="p">}</span>  <span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span> 
 <span class="mi">4057861890</span> <span class="o">|</span> <span class="p">{</span><span class="mi">14887</span><span class="p">,</span><span class="mi">14888</span><span class="p">}</span> <span class="o">|</span> <span class="p">{</span><span class="mi">264</span><span class="p">,</span><span class="mi">16279</span><span class="p">}</span>  <span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span> 
  <span class="mi">606964623</span> <span class="o">|</span> <span class="p">{</span><span class="mi">7987</span><span class="p">}</span>        <span class="o">|</span> <span class="p">{</span><span class="mi">422</span><span class="p">,</span><span class="mi">7988</span><span class="p">}</span>   <span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span> 
  <span class="mi">491465232</span> <span class="o">|</span> <span class="p">{</span><span class="mi">1328</span><span class="p">,</span><span class="mi">1329</span><span class="p">}</span>   <span class="o">|</span> <span class="p">{</span><span class="mi">470</span><span class="p">,</span><span class="mi">13502</span><span class="p">}</span>  <span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span> 
  <span class="mi">491423965</span> <span class="o">|</span> <span class="p">{</span><span class="mi">1065</span><span class="p">}</span>        <span class="o">|</span> <span class="p">{</span><span class="mi">966</span><span class="p">,</span><span class="mi">21336</span><span class="p">}</span>  <span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span> 
 <span class="mi">6950940968</span> <span class="o">|</span> <span class="p">{</span><span class="mi">20481</span><span class="p">}</span>       <span class="o">|</span> <span class="p">{</span><span class="mi">769</span><span class="p">,</span><span class="mi">18904</span><span class="p">}</span>  <span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span> 
<span class="p">(</span><span class="mi">10</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
</section>
<section id="exercise-2-fill-up-other-columns-in-the-vertices-table">
<h3><a class="toc-backref" href="#id5" role="doc-backlink"><span class="section-number">4.2.2. </span>Exercise 2: Fill up other columns in the vertices table</a><a class="headerlink" href="#exercise-2-fill-up-other-columns-in-the-vertices-table" title="Link to this heading">¶</a></h3>
<p class="rubric">Problem</p>
<p>Fill up geometry information on the vertices table.</p>
<p class="rubric">Solution</p>
<p>Count the number of rows that need to be filled up.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="n">FROM</span> <span class="n">ways_vertices</span> <span class="n">WHERE</span> <span class="n">geom</span> <span class="n">IS</span> <span class="n">NULL</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="9e41db82-54ae-4482-a8ec-7cb5f10d4b7b" name="9e41db82-54ae-4482-a8ec-7cb5f10d4b7b" type="checkbox"><label class="sphinx_collapse__label" for="9e41db82-54ae-4482-a8ec-7cb5f10d4b7b"><i class="sphinx_collapse__icon"></i>Number of rows with empty geometry</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">count</span> 
<span class="o">-------</span>
 <span class="mi">24229</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Update the <code class="docutils literal notranslate"><span class="pre">geom</span></code> columns based on the <code class="docutils literal notranslate"><span class="pre">source_osm</span></code> column
from <code class="docutils literal notranslate"><span class="pre">ways</span></code> table.</p></li>
<li><p>Use the start point of the geometry.</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span><span class="w"> </span><span class="n">ways_vertices</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">geom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ST_startPoint</span><span class="p">(</span><span class="n">the_geom</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">ways</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">source_osm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="430c8cbc-6a28-4669-8bc0-134a7b76a6aa" name="430c8cbc-6a28-4669-8bc0-134a7b76a6aa" type="checkbox"><label class="sphinx_collapse__label" for="430c8cbc-6a28-4669-8bc0-134a7b76a6aa"><i class="sphinx_collapse__icon"></i>Number of updated records</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UPDATE</span> <span class="mi">21275</span>
</pre></div>
</div>
</div>
</div>
<p>Not expecting to be done due to the fact that some vertices are only dead ends.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">ways_vertices</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">geom</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="24cb572a-f852-4845-b9aa-86d9ec5a0d56" name="24cb572a-f852-4845-b9aa-86d9ec5a0d56" type="checkbox"><label class="sphinx_collapse__label" for="24cb572a-f852-4845-b9aa-86d9ec5a0d56"><i class="sphinx_collapse__icon"></i>Numbers of records that need update</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">count</span> 
<span class="o">-------</span>
  <span class="mi">2954</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Update the <code class="docutils literal notranslate"><span class="pre">geom</span></code> columns based on the <code class="docutils literal notranslate"><span class="pre">target_osm</span></code> column
from <code class="docutils literal notranslate"><span class="pre">ways</span></code> table.</p></li>
<li><p>Use the end point of the geometry.</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span><span class="w"> </span><span class="n">ways_vertices</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">geom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ST_endPoint</span><span class="p">(</span><span class="n">the_geom</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">ways</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">geom</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">target_osm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="f43199ca-8630-429a-9652-c26bca4be959" name="f43199ca-8630-429a-9652-c26bca4be959" type="checkbox"><label class="sphinx_collapse__label" for="f43199ca-8630-429a-9652-c26bca4be959"><i class="sphinx_collapse__icon"></i>Number of updated records</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UPDATE</span> <span class="mi">2954</span>
</pre></div>
</div>
</div>
</div>
<p>Expecting to be done, that is the geometry column should not have a <code class="docutils literal notranslate"><span class="pre">NULL</span></code>
value.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">ways_vertices</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">geom</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="80abaa83-ce04-4565-81cc-f5ebf9604375" name="80abaa83-ce04-4565-81cc-f5ebf9604375" type="checkbox"><label class="sphinx_collapse__label" for="80abaa83-ce04-4565-81cc-f5ebf9604375"><i class="sphinx_collapse__icon"></i>Count should be 0</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">count</span> 
<span class="o">-------</span>
     <span class="mi">0</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
<p>Update the <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> columns based on the <code class="docutils literal notranslate"><span class="pre">geom</span></code> column.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span><span class="w"> </span><span class="n">ways_vertices</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ST_X</span><span class="p">(</span><span class="n">geom</span><span class="p">),</span><span class="w"> </span><span class="n">ST_Y</span><span class="p">(</span><span class="n">geom</span><span class="p">));</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="90d38c41-c69e-4aa7-9d40-906bc36bdf79" name="90d38c41-c69e-4aa7-9d40-906bc36bdf79" type="checkbox"><label class="sphinx_collapse__label" for="90d38c41-c69e-4aa7-9d40-906bc36bdf79"><i class="sphinx_collapse__icon"></i>Number of updated records</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UPDATE</span> <span class="mi">24229</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="pgr-connectedcomponents">
<h2><a class="toc-backref" href="#id6" role="doc-backlink"><span class="section-number">4.3. </span>pgr_connectedComponents</a><a class="headerlink" href="#pgr-connectedcomponents" title="Link to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">pgr_connectedComponents</span></code> compute the connected components of an undirected
graph using a Depth First Search approach. A connected component of an
undirected graph is a set of vertices that are all reachable from each other.</p>
<p class="rubric">Signature summary</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">pgr_connectedComponents</span><span class="p">(</span><span class="n">edges_sql</span><span class="p">)</span>

<span class="k">RETURNS</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="k">OF</span><span class="w"> </span><span class="p">(</span><span class="n">seq</span><span class="p">,</span><span class="w"> </span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="n">node</span><span class="p">)</span>
<span class="k">OR</span><span class="w"> </span><span class="n">EMPTY</span><span class="w"> </span><span class="k">SET</span>
</pre></div>
</div>
<p>Description of the function can be found in <a class="reference external" href="https://docs.pgrouting.org/latest/en/pgr_connectedComponents.html">pgr_connectedComponents</a></p>
<section id="exercise-3-set-components-on-edges-and-vertices-tables">
<h3><a class="toc-backref" href="#id7" role="doc-backlink"><span class="section-number">4.3.1. </span>Exercise 3: Set components on edges and vertices tables</a><a class="headerlink" href="#exercise-3-set-components-on-edges-and-vertices-tables" title="Link to this heading">¶</a></h3>
<p class="rubric">Problem</p>
<p>Get the information about the graph components.</p>
<p class="rubric">Solution</p>
<p>Create additional columns on the edges and vertices tables.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">ways</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">;</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">ways_vertices</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="cac6387e-90f3-471c-bb8c-0b483b3851b9" name="cac6387e-90f3-471c-bb8c-0b483b3851b9" type="checkbox"><label class="sphinx_collapse__label" for="cac6387e-90f3-471c-bb8c-0b483b3851b9"><i class="sphinx_collapse__icon"></i>Message about creation of columns</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ALTER</span> <span class="n">TABLE</span>
<span class="n">ALTER</span> <span class="n">TABLE</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">pgr_connectedComponents</span></code> to fill up the vertices table.</p>
<ul>
<li><p>Use the results to store the component numbers on the vertices table.
(<strong>line 1</strong>)</p></li>
<li><p>Use the OSM identifiers of the vertices. (<strong>lines 4-5</strong>)</p></li>
</ul>
</li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="k">UPDATE</span><span class="w"> </span><span class="n">ways_vertices</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">component</span>
</span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">pgr_connectedComponents</span><span class="p">(</span>
<span class="w">  </span><span class="s1">&#39;SELECT gid as id,</span>
<span class="hll"><span class="s1">    source_osm AS source,</span>
</span><span class="hll"><span class="s1">    target_osm AS target,</span>
</span><span class="s1">    cost, reverse_cost FROM ways&#39;</span>
<span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">c</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="aa397c8f-01ed-4cf1-9da4-bcb150792258" name="aa397c8f-01ed-4cf1-9da4-bcb150792258" type="checkbox"><label class="sphinx_collapse__label" for="aa397c8f-01ed-4cf1-9da4-bcb150792258"><i class="sphinx_collapse__icon"></i>Number of updated records</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UPDATE</span> <span class="mi">24229</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Update the edges table with based on the component number of the vertex</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span><span class="w"> </span><span class="n">ways</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">component</span>
<span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">ways_vertices</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">v</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">source_osm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">id</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="da9758e0-e09d-4d5e-b99d-98cf0b016715" name="da9758e0-e09d-4d5e-b99d-98cf0b016715" type="checkbox"><label class="sphinx_collapse__label" for="da9758e0-e09d-4d5e-b99d-98cf0b016715"><i class="sphinx_collapse__icon"></i>Number of updated records</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UPDATE</span> <span class="mi">32586</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="exercise-4-inspect-the-components">
<h3><a class="toc-backref" href="#id8" role="doc-backlink"><span class="section-number">4.3.2. </span>Exercise 4: Inspect the components</a><a class="headerlink" href="#exercise-4-inspect-the-components" title="Link to this heading">¶</a></h3>
<p class="rubric">Problem</p>
<p>Answer the following questions:</p>
<ol class="arabic simple">
<li><p>How many components are in the vertices table?</p></li>
<li><p>How many components are in the edges table?</p></li>
<li><p>List the 10 components with more edges.</p></li>
<li><p>Get the component with the maximum number of edges.</p></li>
</ol>
<p class="rubric">Solution</p>
<ol class="arabic simple">
<li><p>How many components are in the vertices table?</p></li>
</ol>
<p>Count the distinct components.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">component</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">ways_vertices</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="7dc67221-d82f-4689-b738-779e6d0e7c48" name="7dc67221-d82f-4689-b738-779e6d0e7c48" type="checkbox"><label class="sphinx_collapse__label" for="7dc67221-d82f-4689-b738-779e6d0e7c48"><i class="sphinx_collapse__icon"></i>Number of components on vertex table</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">count</span> 
<span class="o">-------</span>
   <span class="mi">108</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
<ol class="arabic simple" start="2">
<li><p>How many components are in the edges table?</p></li>
</ol>
<p>Count the distinct components.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">component</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">ways</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="c8952b97-a165-41db-ab5e-bf0ed8e08ce5" name="c8952b97-a165-41db-ab5e-bf0ed8e08ce5" type="checkbox"><label class="sphinx_collapse__label" for="c8952b97-a165-41db-ab5e-bf0ed8e08ce5"><i class="sphinx_collapse__icon"></i>Number of components on edge table</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">count</span> 
<span class="o">-------</span>
   <span class="mi">108</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
<ol class="arabic simple" start="3">
<li><p>List the 10 components with more edges.</p></li>
</ol>
<ul class="simple">
<li><p>Count number of rows grouped by component. (<strong>line 1</strong>)</p></li>
<li><p>Inverse order to display the top 10. (<strong>line 2</strong>)</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">ways</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">component</span>
<span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">count</span><span class="w"> </span><span class="k">DESC</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="2cb41da6-a8a5-442a-ae64-5f73fa977384" name="2cb41da6-a8a5-442a-ae64-5f73fa977384" type="checkbox"><label class="sphinx_collapse__label" for="2cb41da6-a8a5-442a-ae64-5f73fa977384"><i class="sphinx_collapse__icon"></i>Top 10 components</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">component</span>  <span class="o">|</span> <span class="n">count</span> 
<span class="o">-------------+-------</span>
   <span class="mi">247780039</span> <span class="o">|</span> <span class="mi">32164</span>
  <span class="mi">5857529375</span> <span class="o">|</span>   <span class="mi">117</span>
 <span class="mi">11351599106</span> <span class="o">|</span>    <span class="mi">22</span>
  <span class="mi">4321917778</span> <span class="o">|</span>    <span class="mi">19</span>
 <span class="mi">11177916097</span> <span class="o">|</span>    <span class="mi">17</span>
  <span class="mi">6117200807</span> <span class="o">|</span>    <span class="mi">15</span>
  <span class="mi">3976699256</span> <span class="o">|</span>    <span class="mi">14</span>
 <span class="mi">11776230037</span> <span class="o">|</span>    <span class="mi">13</span>
 <span class="mi">11177916268</span> <span class="o">|</span>    <span class="mi">10</span>
 <span class="mi">11352002684</span> <span class="o">|</span>    <span class="mi">10</span>
<span class="p">(</span><span class="mi">10</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
<ol class="arabic simple" start="4">
<li><p>Get the component with the maximum number of edges.</p></li>
</ol>
<ul class="simple">
<li><p>Use the query from last question to get the maximum count</p></li>
<li><p>Get the component that matches the maximum value.</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">WITH</span>
<span class="n">all_components</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">ways</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">component</span><span class="p">),</span>
<span class="n">max_component</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">max</span><span class="p">(</span><span class="k">count</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">all_components</span><span class="p">)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">all_components</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">max</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">max_component</span><span class="p">);</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="736f1569-6327-415b-b022-e85df620c9c5" name="736f1569-6327-415b-b022-e85df620c9c5" type="checkbox"><label class="sphinx_collapse__label" for="736f1569-6327-415b-b022-e85df620c9c5"><i class="sphinx_collapse__icon"></i>Component with maxmum edge count</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">component</span> 
<span class="o">-----------</span>
 <span class="mi">247780039</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="preparing-the-graphs">
<h2><a class="toc-backref" href="#id9" role="doc-backlink"><span class="section-number">4.4. </span>Preparing the graphs</a><a class="headerlink" href="#preparing-the-graphs" title="Link to this heading">¶</a></h2>
<section id="exercise-5-creating-a-view-for-routing">
<h3><a class="toc-backref" href="#id10" role="doc-backlink"><span class="section-number">4.4.1. </span>Exercise 5: Creating a view for routing</a><a class="headerlink" href="#exercise-5-creating-a-view-for-routing" title="Link to this heading">¶</a></h3>
<a class="reference internal image-reference" href="../_images/vehicle_net.png"><img alt="View of roads for vehicles" src="../_images/vehicle_net.png" style="width: 333.0px; height: 217.25px;" />
</a>
<p class="rubric">Problem</p>
<ul class="simple">
<li><p>Create a view with minimal amount of information for processing the particular vehicles.</p></li>
<li><p>Use the OSM identifiers on the vertices.</p></li>
<li><p>Routing <cite>cost</cite> and <cite>reverse_cost</cite> in terms of seconds for routing calculations.</p></li>
<li><p>Exclude <cite>steps</cite>, <cite>footway</cite>, <cite>path</cite>, <cite>cycleway</cite> segments.</p></li>
<li><p>Data needed in the view for further processing.</p>
<ul>
<li><p><cite>name</cite> The name of the segment.</p></li>
<li><p><cite>length_m</cite> The length in meters rename to <code class="docutils literal notranslate"><span class="pre">length</span></code>.</p></li>
<li><p><cite>the_geom</cite> The geometry rename to <code class="docutils literal notranslate"><span class="pre">geom</span></code>.</p></li>
</ul>
</li>
<li><p>Verify the number of edges was reduced.</p></li>
</ul>
<p class="rubric">Solution</p>
<p>Creating the view:</p>
<ul class="simple">
<li><p>If you need to reconstruct the view, first drop it using the command on <strong>line
1</strong>.</p></li>
<li><p>Get the component with maximum number of edges (<strong>lines 6-10</strong>)</p></li>
<li><p>The <cite>source</cite> and <cite>target</cite> requirements for the function are to be with OSM
identifiers. (line <strong>14</strong>)</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">cost</span></code> and <code class="docutils literal notranslate"><span class="pre">reverse_cost</span></code> are in terms of seconds. (line <strong>15</strong>)</p></li>
<li><p>The additional parameters <code class="docutils literal notranslate"><span class="pre">length_m</span></code> and <code class="docutils literal notranslate"><span class="pre">the_geom</span></code> are renamed, <code class="docutils literal notranslate"><span class="pre">name</span></code>
is also included. (line <strong>16</strong>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">JOIN</span></code> with the <cite>configuration</cite>:</p>
<ul>
<li><p>Exclude <cite>steps</cite>, <cite>footway</cite>, <cite>path</cite>, <cite>cycleway</cite>. (line <strong>18</strong>)</p></li>
</ul>
</li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- DROP VIEW vehicle_net CASCADE;</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">vehicle_net</span><span class="w"> </span><span class="k">AS</span>

<span class="k">WITH</span>
<span class="hll"><span class="n">all_components</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">ways</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">component</span><span class="p">),</span><span class="w"> </span><span class="c1">-- line 6</span>
</span><span class="hll"><span class="n">max_component</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">max</span><span class="p">(</span><span class="k">count</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">all_components</span><span class="p">),</span>
</span><span class="hll"><span class="n">the_component</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
</span><span class="hll"><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">all_components</span>
</span><span class="hll"><span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="k">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">max</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">max_component</span><span class="p">))</span>
</span>
<span class="k">SELECT</span>
<span class="w">  </span><span class="n">gid</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
<span class="hll"><span class="w">  </span><span class="n">source_osm</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">source</span><span class="p">,</span><span class="w"> </span><span class="n">target_osm</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">target</span><span class="p">,</span><span class="w"> </span><span class="c1">-- line 14</span>
</span><span class="hll"><span class="w">  </span><span class="n">cost_s</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">cost</span><span class="p">,</span><span class="w"> </span><span class="n">reverse_cost_s</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">reverse_cost</span><span class="p">,</span>
</span><span class="hll"><span class="w">  </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">length_m</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">length</span><span class="p">,</span><span class="w"> </span><span class="n">the_geom</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">geom</span>
</span><span class="k">FROM</span><span class="w"> </span><span class="n">ways</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">the_component</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="p">(</span><span class="n">component</span><span class="p">)</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="p">(</span><span class="n">tag_id</span><span class="p">)</span>
<span class="hll"><span class="k">WHERE</span><span class="w">  </span><span class="n">tag_value</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;steps&#39;</span><span class="p">,</span><span class="s1">&#39;footway&#39;</span><span class="p">,</span><span class="s1">&#39;path&#39;</span><span class="p">,</span><span class="s1">&#39;cycleway&#39;</span><span class="p">);</span><span class="w"> </span><span class="c1">-- line 18</span>
</span></pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="d39cad6b-0dc3-4e79-b125-d8ca006d545a" name="d39cad6b-0dc3-4e79-b125-d8ca006d545a" type="checkbox"><label class="sphinx_collapse__label" for="d39cad6b-0dc3-4e79-b125-d8ca006d545a"><i class="sphinx_collapse__icon"></i>Response of command</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">VIEW</span>
</pre></div>
</div>
</div>
</div>
<p>Verification:</p>
<p>Count the rows on the original <code class="docutils literal notranslate"><span class="pre">ways</span></code> and on <code class="docutils literal notranslate"><span class="pre">vehicle_net</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="n">FROM</span> <span class="n">ways</span><span class="p">;</span>
<span class="n">SELECT</span> <span class="n">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="n">FROM</span> <span class="n">vehicle_net</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="87137219-d670-4360-b7e5-213828c64533" name="87137219-d670-4360-b7e5-213828c64533" type="checkbox"><label class="sphinx_collapse__label" for="87137219-d670-4360-b7e5-213828c64533"><i class="sphinx_collapse__icon"></i>Row count results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">count</span> 
<span class="o">-------</span>
 <span class="mi">32586</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>

 <span class="n">count</span> 
<span class="o">-------</span>
 <span class="mi">27632</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
<p>Get the description of the view</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">dS</span><span class="o">+</span> <span class="n">vehicle_net</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="9c8d9c7b-97a1-4fd6-bc96-73710f6eb654" name="9c8d9c7b-97a1-4fd6-bc96-73710f6eb654" type="checkbox"><label class="sphinx_collapse__label" for="9c8d9c7b-97a1-4fd6-bc96-73710f6eb654"><i class="sphinx_collapse__icon"></i>The view description</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                                     <span class="n">View</span> <span class="s2">&quot;public.vehicle_net&quot;</span>
    <span class="n">Column</span>    <span class="o">|</span>           <span class="n">Type</span>            <span class="o">|</span> <span class="n">Collation</span> <span class="o">|</span> <span class="n">Nullable</span> <span class="o">|</span> <span class="n">Default</span> <span class="o">|</span> <span class="n">Storage</span>  <span class="o">|</span> <span class="n">Description</span> 
<span class="o">--------------+---------------------------+-----------+----------+---------+----------+-------------</span>
 <span class="nb">id</span>           <span class="o">|</span> <span class="n">bigint</span>                    <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span> 
 <span class="n">source</span>       <span class="o">|</span> <span class="n">bigint</span>                    <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span> 
 <span class="n">target</span>       <span class="o">|</span> <span class="n">bigint</span>                    <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span> 
 <span class="n">cost</span>         <span class="o">|</span> <span class="n">double</span> <span class="n">precision</span>          <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span> 
 <span class="n">reverse_cost</span> <span class="o">|</span> <span class="n">double</span> <span class="n">precision</span>          <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span> 
 <span class="n">name</span>         <span class="o">|</span> <span class="n">text</span>                      <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">extended</span> <span class="o">|</span> 
 <span class="n">length</span>       <span class="o">|</span> <span class="n">double</span> <span class="n">precision</span>          <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span> 
 <span class="n">geom</span>         <span class="o">|</span> <span class="n">geometry</span><span class="p">(</span><span class="n">LineString</span><span class="p">,</span><span class="mi">4326</span><span class="p">)</span> <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">main</span>     <span class="o">|</span> 
<span class="n">View</span> <span class="n">definition</span><span class="p">:</span>
 <span class="n">WITH</span> <span class="n">all_components</span> <span class="n">AS</span> <span class="p">(</span>
         <span class="n">SELECT</span> <span class="n">ways_1</span><span class="o">.</span><span class="n">component</span><span class="p">,</span>
            <span class="n">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="n">AS</span> <span class="n">count</span>
           <span class="n">FROM</span> <span class="n">ways</span> <span class="n">ways_1</span>
          <span class="n">GROUP</span> <span class="n">BY</span> <span class="n">ways_1</span><span class="o">.</span><span class="n">component</span>
        <span class="p">),</span> <span class="n">max_component</span> <span class="n">AS</span> <span class="p">(</span>
         <span class="n">SELECT</span> <span class="nb">max</span><span class="p">(</span><span class="n">all_components</span><span class="o">.</span><span class="n">count</span><span class="p">)</span> <span class="n">AS</span> <span class="nb">max</span>
           <span class="n">FROM</span> <span class="n">all_components</span>
        <span class="p">),</span> <span class="n">the_component</span> <span class="n">AS</span> <span class="p">(</span>
         <span class="n">SELECT</span> <span class="n">all_components</span><span class="o">.</span><span class="n">component</span>
           <span class="n">FROM</span> <span class="n">all_components</span>
          <span class="n">WHERE</span> <span class="n">all_components</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="p">((</span> <span class="n">SELECT</span> <span class="n">max_component</span><span class="o">.</span><span class="n">max</span>
                   <span class="n">FROM</span> <span class="n">max_component</span><span class="p">))</span>
        <span class="p">)</span>
 <span class="n">SELECT</span> <span class="n">ways</span><span class="o">.</span><span class="n">gid</span> <span class="n">AS</span> <span class="nb">id</span><span class="p">,</span>
    <span class="n">ways</span><span class="o">.</span><span class="n">source_osm</span> <span class="n">AS</span> <span class="n">source</span><span class="p">,</span>
    <span class="n">ways</span><span class="o">.</span><span class="n">target_osm</span> <span class="n">AS</span> <span class="n">target</span><span class="p">,</span>
    <span class="n">ways</span><span class="o">.</span><span class="n">cost_s</span> <span class="n">AS</span> <span class="n">cost</span><span class="p">,</span>
    <span class="n">ways</span><span class="o">.</span><span class="n">reverse_cost_s</span> <span class="n">AS</span> <span class="n">reverse_cost</span><span class="p">,</span>
    <span class="n">ways</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
    <span class="n">ways</span><span class="o">.</span><span class="n">length_m</span> <span class="n">AS</span> <span class="n">length</span><span class="p">,</span>
    <span class="n">ways</span><span class="o">.</span><span class="n">the_geom</span> <span class="n">AS</span> <span class="n">geom</span>
   <span class="n">FROM</span> <span class="n">ways</span>
     <span class="n">JOIN</span> <span class="n">the_component</span> <span class="n">USING</span> <span class="p">(</span><span class="n">component</span><span class="p">)</span>
     <span class="n">JOIN</span> <span class="n">configuration</span> <span class="n">USING</span> <span class="p">(</span><span class="n">tag_id</span><span class="p">)</span>
  <span class="n">WHERE</span> <span class="n">configuration</span><span class="o">.</span><span class="n">tag_value</span> <span class="o">&lt;&gt;</span> <span class="n">ALL</span> <span class="p">(</span><span class="n">ARRAY</span><span class="p">[</span><span class="s1">&#39;steps&#39;</span><span class="p">::</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;footway&#39;</span><span class="p">::</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;path&#39;</span><span class="p">::</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;cycleway&#39;</span><span class="p">::</span><span class="n">text</span><span class="p">]);</span>

</pre></div>
</div>
</div>
</div>
</section>
<section id="exercise-6-limiting-the-road-network-within-an-area">
<h3><a class="toc-backref" href="#id11" role="doc-backlink"><span class="section-number">4.4.2. </span>Exercise 6: Limiting the road network within an area</a><a class="headerlink" href="#exercise-6-limiting-the-road-network-within-an-area" title="Link to this heading">¶</a></h3>
<a class="reference internal image-reference" href="../_images/taxi_net.png"><img alt="View of smaller set of roads for vehicles" src="../_images/taxi_net.png" style="width: 333.0px; height: 217.25px;" />
</a>
<p class="rubric">Problem</p>
<ul class="simple">
<li><p>Create a view <code class="docutils literal notranslate"><span class="pre">taxi_net</span></code> for the <cite>taxi</cite>:</p>
<ul>
<li><p>The taxi can only circulate inside this Bounding Box: <code class="docutils literal notranslate"><span class="pre">(-48.52,-1.46,-48.45,-1.41)</span></code></p></li>
<li><p>The taxi speed is 10% slower than the particular vehicle.</p></li>
</ul>
</li>
<li><p>Verify the reduced number of road segments.</p></li>
</ul>
<p class="rubric">Solution</p>
<p>Creating the view:</p>
<ul class="simple">
<li><p>Adjust the taxi’s <code class="docutils literal notranslate"><span class="pre">cost</span></code> and <code class="docutils literal notranslate"><span class="pre">reverse_cost</span></code> to be 10% slower than of the
particular vehicle. (line <strong>7</strong>)</p></li>
<li><p>The graph for the taxi is a subset of the <code class="docutils literal notranslate"><span class="pre">vehicle_net</span></code> graph. (line <strong>9</strong>)</p></li>
<li><p>Can only circulate inside the bounding box:
<code class="docutils literal notranslate"><span class="pre">(-48.52,-1.46,-48.45,-1.41)</span></code>. (line <strong>10</strong>)</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- DROP VIEW taxi_net;</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">taxi_net</span><span class="w"> </span><span class="k">AS</span>
<span class="w">    </span><span class="k">SELECT</span>
<span class="w">      </span><span class="n">id</span><span class="p">,</span>
<span class="w">      </span><span class="k">source</span><span class="p">,</span><span class="w"> </span><span class="n">target</span><span class="p">,</span>
<span class="hll"><span class="w">      </span><span class="n">cost</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">10</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">cost</span><span class="p">,</span><span class="w"> </span><span class="n">reverse_cost</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">10</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">reverse_cost</span><span class="p">,</span>
</span><span class="w">      </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">length</span><span class="p">,</span><span class="w"> </span><span class="n">geom</span>
<span class="hll"><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">vehicle_net</span>
</span><span class="hll"><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">vehicle_net</span><span class="p">.</span><span class="n">geom</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">ST_MakeEnvelope</span><span class="p">(</span><span class="o">-</span><span class="mi">48</span><span class="p">.</span><span class="mi">52</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">46</span><span class="p">,</span><span class="o">-</span><span class="mi">48</span><span class="p">.</span><span class="mi">45</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">41</span><span class="p">);</span>
</span></pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="82930419-5979-4607-a13a-f671f1141c09" name="82930419-5979-4607-a13a-f671f1141c09" type="checkbox"><label class="sphinx_collapse__label" for="82930419-5979-4607-a13a-f671f1141c09"><i class="sphinx_collapse__icon"></i>Response of command</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">VIEW</span>
</pre></div>
</div>
</div>
</div>
<p>Count the rows on <code class="docutils literal notranslate"><span class="pre">taxi_net</span></code>.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">taxi_net</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="ede4000e-a7ae-4491-ac92-2056230fa3b5" name="ede4000e-a7ae-4491-ac92-2056230fa3b5" type="checkbox"><label class="sphinx_collapse__label" for="ede4000e-a7ae-4491-ac92-2056230fa3b5"><i class="sphinx_collapse__icon"></i>Row count results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">count</span> 
<span class="o">-------</span>
  <span class="mi">9180</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
<p>Get the description.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">dS</span><span class="o">+</span> <span class="n">taxi_net</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="bb4f29ee-7a3b-4e0a-aecf-094dc8929a02" name="bb4f29ee-7a3b-4e0a-aecf-094dc8929a02" type="checkbox"><label class="sphinx_collapse__label" for="bb4f29ee-7a3b-4e0a-aecf-094dc8929a02"><i class="sphinx_collapse__icon"></i>The view description</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                                       <span class="n">View</span> <span class="s2">&quot;public.taxi_net&quot;</span>
    <span class="n">Column</span>    <span class="o">|</span>           <span class="n">Type</span>            <span class="o">|</span> <span class="n">Collation</span> <span class="o">|</span> <span class="n">Nullable</span> <span class="o">|</span> <span class="n">Default</span> <span class="o">|</span> <span class="n">Storage</span>  <span class="o">|</span> <span class="n">Description</span> 
<span class="o">--------------+---------------------------+-----------+----------+---------+----------+-------------</span>
 <span class="nb">id</span>           <span class="o">|</span> <span class="n">bigint</span>                    <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span> 
 <span class="n">source</span>       <span class="o">|</span> <span class="n">bigint</span>                    <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span> 
 <span class="n">target</span>       <span class="o">|</span> <span class="n">bigint</span>                    <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span> 
 <span class="n">cost</span>         <span class="o">|</span> <span class="n">double</span> <span class="n">precision</span>          <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span> 
 <span class="n">reverse_cost</span> <span class="o">|</span> <span class="n">double</span> <span class="n">precision</span>          <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span> 
 <span class="n">name</span>         <span class="o">|</span> <span class="n">text</span>                      <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">extended</span> <span class="o">|</span> 
 <span class="n">length</span>       <span class="o">|</span> <span class="n">double</span> <span class="n">precision</span>          <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span> 
 <span class="n">geom</span>         <span class="o">|</span> <span class="n">geometry</span><span class="p">(</span><span class="n">LineString</span><span class="p">,</span><span class="mi">4326</span><span class="p">)</span> <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">main</span>     <span class="o">|</span> 
<span class="n">View</span> <span class="n">definition</span><span class="p">:</span>
 <span class="n">SELECT</span> <span class="nb">id</span><span class="p">,</span>
    <span class="n">source</span><span class="p">,</span>
    <span class="n">target</span><span class="p">,</span>
    <span class="n">cost</span> <span class="o">*</span> <span class="mf">1.10</span><span class="p">::</span><span class="n">double</span> <span class="n">precision</span> <span class="n">AS</span> <span class="n">cost</span><span class="p">,</span>
    <span class="n">reverse_cost</span> <span class="o">*</span> <span class="mf">1.10</span><span class="p">::</span><span class="n">double</span> <span class="n">precision</span> <span class="n">AS</span> <span class="n">reverse_cost</span><span class="p">,</span>
    <span class="n">name</span><span class="p">,</span>
    <span class="n">length</span><span class="p">,</span>
    <span class="n">geom</span>
   <span class="n">FROM</span> <span class="n">vehicle_net</span>
  <span class="n">WHERE</span> <span class="n">geom</span> <span class="o">&amp;&amp;</span> <span class="n">st_makeenvelope</span><span class="p">(</span><span class="s1">&#39;-48.52&#39;</span><span class="p">::</span><span class="n">numeric</span><span class="p">::</span><span class="n">double</span> <span class="n">precision</span><span class="p">,</span> <span class="s1">&#39;-1.46&#39;</span><span class="p">::</span><span class="n">numeric</span><span class="p">::</span><span class="n">double</span> <span class="n">precision</span><span class="p">,</span> <span class="s1">&#39;-48.45&#39;</span><span class="p">::</span><span class="n">numeric</span><span class="p">::</span><span class="n">double</span> <span class="n">precision</span><span class="p">,</span> <span class="s1">&#39;-1.41&#39;</span><span class="p">::</span><span class="n">numeric</span><span class="p">::</span><span class="n">double</span> <span class="n">precision</span><span class="p">);</span>

</pre></div>
</div>
</div>
</div>
</section>
<section id="exercise-7-creating-a-materialized-view-for-routing-pedestrians">
<h3><a class="toc-backref" href="#id12" role="doc-backlink"><span class="section-number">4.4.3. </span>Exercise 7: Creating a materialized view for routing pedestrians</a><a class="headerlink" href="#exercise-7-creating-a-materialized-view-for-routing-pedestrians" title="Link to this heading">¶</a></h3>
<a class="reference internal image-reference" href="../_images/walk_net.png"><img alt="View of roads for pedestrians" src="../_images/walk_net.png" style="width: 333.0px; height: 217.25px;" />
</a>
<p class="rubric">Problem</p>
<ul class="simple">
<li><p>Create a materialized view with minimal amount of information for processing pedestrians.</p></li>
<li><p>Routing <cite>cost</cite> and <cite>reverse_cost</cite> will be on seconds for routing calculations.</p>
<ul>
<li><p>The speed is <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">mts/sec</span></code>.</p></li>
</ul>
</li>
<li><p>Exclude <cite>motorway</cite> , <cite>primary</cite> and <cite>secondary</cite> segments.</p></li>
<li><p>Data needed in the view for further processing.</p>
<ul>
<li><p><cite>length_m</cite> The length in meters.</p></li>
<li><p><cite>the_geom</cite> The geometry.</p></li>
</ul>
</li>
<li><p>Verify the number of edges was reduced.</p></li>
</ul>
<p class="rubric">Solution</p>
<ul class="simple">
<li><p>Creating the view:</p>
<ul>
<li><p>Similar to <a class="reference internal" href="#exercise-5-creating-a-view-for-routing">Exercise 5: Creating a view for routing</a>:</p>
<ul>
<li><p>The <code class="docutils literal notranslate"><span class="pre">cost</span></code> and <code class="docutils literal notranslate"><span class="pre">reverse_cost</span></code> are in terms of seconds with speed of <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">mts/sec</span></code>. (line <strong>7</strong>)</p></li>
<li><p>Exclude <cite>motorway</cite>, <cite>primary</cite> and <cite>secondary</cite> . (line <strong>11</strong>)</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- DROP MATERIALIZED VIEW walk_net CASCADE;</span>

<span class="k">CREATE</span><span class="w"> </span><span class="n">MATERIALIZED</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">walk_net</span><span class="w"> </span><span class="k">AS</span>

<span class="k">WITH</span>
<span class="n">allc</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">ways</span><span class="w"> </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">component</span><span class="p">),</span>
<span class="hll"><span class="n">maxcount</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">max</span><span class="p">(</span><span class="k">count</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">allc</span><span class="p">),</span>
</span><span class="n">the_component</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">allc</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">max</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">maxcount</span><span class="p">))</span>

<span class="k">SELECT</span>
<span class="hll"><span class="w">  </span><span class="n">gid</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id</span><span class="p">,</span>
</span><span class="w">  </span><span class="n">source_osm</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">source</span><span class="p">,</span><span class="w"> </span><span class="n">target_osm</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">target</span><span class="p">,</span>
<span class="w">  </span><span class="n">cost_s</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">cost</span><span class="p">,</span><span class="w"> </span><span class="n">reverse_cost_s</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">reverse_cost</span><span class="p">,</span>
<span class="w">  </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">length_m</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">length</span><span class="p">,</span><span class="w"> </span><span class="n">the_geom</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">geom</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">ways</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">the_component</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="p">(</span><span class="n">component</span><span class="p">)</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="p">(</span><span class="n">tag_id</span><span class="p">)</span>
<span class="k">WHERE</span><span class="w">  </span><span class="n">tag_value</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;motorway&#39;</span><span class="p">,</span><span class="s1">&#39;primary&#39;</span><span class="p">,</span><span class="s1">&#39;secondary&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="9928ad2e-f78f-4f65-8bdd-a5716d8a5d5f" name="9928ad2e-f78f-4f65-8bdd-a5716d8a5d5f" type="checkbox"><label class="sphinx_collapse__label" for="9928ad2e-f78f-4f65-8bdd-a5716d8a5d5f"><i class="sphinx_collapse__icon"></i>Response of command</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="mi">28450</span>
</pre></div>
</div>
</div>
</div>
<p>Count the rows on the view <code class="docutils literal notranslate"><span class="pre">walk_net</span></code>.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">walk_net</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="e6124b22-54ba-4e97-8d82-78e2d9eca15a" name="e6124b22-54ba-4e97-8d82-78e2d9eca15a" type="checkbox"><label class="sphinx_collapse__label" for="e6124b22-54ba-4e97-8d82-78e2d9eca15a"><i class="sphinx_collapse__icon"></i>Row count results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">count</span> 
<span class="o">-------</span>
 <span class="mi">28450</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
<p>Get the description.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">dS</span><span class="o">+</span> <span class="n">walk_net</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="d0ae78a6-00bc-4f52-afc0-7f9cbe9a8943" name="d0ae78a6-00bc-4f52-afc0-7f9cbe9a8943" type="checkbox"><label class="sphinx_collapse__label" for="d0ae78a6-00bc-4f52-afc0-7f9cbe9a8943"><i class="sphinx_collapse__icon"></i>The view description</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                                               <span class="n">Materialized</span> <span class="n">view</span> <span class="s2">&quot;public.walk_net&quot;</span>
    <span class="n">Column</span>    <span class="o">|</span>           <span class="n">Type</span>            <span class="o">|</span> <span class="n">Collation</span> <span class="o">|</span> <span class="n">Nullable</span> <span class="o">|</span> <span class="n">Default</span> <span class="o">|</span> <span class="n">Storage</span>  <span class="o">|</span> <span class="n">Compression</span> <span class="o">|</span> <span class="n">Stats</span> <span class="n">target</span> <span class="o">|</span> <span class="n">Description</span> 
<span class="o">--------------+---------------------------+-----------+----------+---------+----------+-------------+--------------+-------------</span>
 <span class="nb">id</span>           <span class="o">|</span> <span class="n">bigint</span>                    <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
 <span class="n">source</span>       <span class="o">|</span> <span class="n">bigint</span>                    <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
 <span class="n">target</span>       <span class="o">|</span> <span class="n">bigint</span>                    <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
 <span class="n">cost</span>         <span class="o">|</span> <span class="n">double</span> <span class="n">precision</span>          <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
 <span class="n">reverse_cost</span> <span class="o">|</span> <span class="n">double</span> <span class="n">precision</span>          <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
 <span class="n">name</span>         <span class="o">|</span> <span class="n">text</span>                      <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">extended</span> <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
 <span class="n">length</span>       <span class="o">|</span> <span class="n">double</span> <span class="n">precision</span>          <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
 <span class="n">geom</span>         <span class="o">|</span> <span class="n">geometry</span><span class="p">(</span><span class="n">LineString</span><span class="p">,</span><span class="mi">4326</span><span class="p">)</span> <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">main</span>     <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
<span class="n">View</span> <span class="n">definition</span><span class="p">:</span>
 <span class="n">WITH</span> <span class="n">allc</span> <span class="n">AS</span> <span class="p">(</span>
         <span class="n">SELECT</span> <span class="n">ways_1</span><span class="o">.</span><span class="n">component</span><span class="p">,</span>
            <span class="n">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="n">AS</span> <span class="n">count</span>
           <span class="n">FROM</span> <span class="n">ways</span> <span class="n">ways_1</span>
          <span class="n">GROUP</span> <span class="n">BY</span> <span class="n">ways_1</span><span class="o">.</span><span class="n">component</span>
        <span class="p">),</span> <span class="n">maxcount</span> <span class="n">AS</span> <span class="p">(</span>
         <span class="n">SELECT</span> <span class="nb">max</span><span class="p">(</span><span class="n">allc</span><span class="o">.</span><span class="n">count</span><span class="p">)</span> <span class="n">AS</span> <span class="nb">max</span>
           <span class="n">FROM</span> <span class="n">allc</span>
        <span class="p">),</span> <span class="n">the_component</span> <span class="n">AS</span> <span class="p">(</span>
         <span class="n">SELECT</span> <span class="n">allc</span><span class="o">.</span><span class="n">component</span>
           <span class="n">FROM</span> <span class="n">allc</span>
          <span class="n">WHERE</span> <span class="n">allc</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="p">((</span> <span class="n">SELECT</span> <span class="n">maxcount</span><span class="o">.</span><span class="n">max</span>
                   <span class="n">FROM</span> <span class="n">maxcount</span><span class="p">))</span>
        <span class="p">)</span>
 <span class="n">SELECT</span> <span class="n">ways</span><span class="o">.</span><span class="n">gid</span> <span class="n">AS</span> <span class="nb">id</span><span class="p">,</span>
    <span class="n">ways</span><span class="o">.</span><span class="n">source_osm</span> <span class="n">AS</span> <span class="n">source</span><span class="p">,</span>
    <span class="n">ways</span><span class="o">.</span><span class="n">target_osm</span> <span class="n">AS</span> <span class="n">target</span><span class="p">,</span>
    <span class="n">ways</span><span class="o">.</span><span class="n">cost_s</span> <span class="n">AS</span> <span class="n">cost</span><span class="p">,</span>
    <span class="n">ways</span><span class="o">.</span><span class="n">reverse_cost_s</span> <span class="n">AS</span> <span class="n">reverse_cost</span><span class="p">,</span>
    <span class="n">ways</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
    <span class="n">ways</span><span class="o">.</span><span class="n">length_m</span> <span class="n">AS</span> <span class="n">length</span><span class="p">,</span>
    <span class="n">ways</span><span class="o">.</span><span class="n">the_geom</span> <span class="n">AS</span> <span class="n">geom</span>
   <span class="n">FROM</span> <span class="n">ways</span>
     <span class="n">JOIN</span> <span class="n">the_component</span> <span class="n">USING</span> <span class="p">(</span><span class="n">component</span><span class="p">)</span>
     <span class="n">JOIN</span> <span class="n">configuration</span> <span class="n">USING</span> <span class="p">(</span><span class="n">tag_id</span><span class="p">)</span>
  <span class="n">WHERE</span> <span class="n">configuration</span><span class="o">.</span><span class="n">tag_value</span> <span class="o">&lt;&gt;</span> <span class="n">ALL</span> <span class="p">(</span><span class="n">ARRAY</span><span class="p">[</span><span class="s1">&#39;motorway&#39;</span><span class="p">::</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;primary&#39;</span><span class="p">::</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;secondary&#39;</span><span class="p">::</span><span class="n">text</span><span class="p">]);</span>
<span class="n">Access</span> <span class="n">method</span><span class="p">:</span> <span class="n">heap</span>

</pre></div>
</div>
</div>
</div>
</section>
<section id="exercise-8-testing-the-views-for-routing">
<h3><a class="toc-backref" href="#id13" role="doc-backlink"><span class="section-number">4.4.4. </span>Exercise 8: Testing the views for routing</a><a class="headerlink" href="#exercise-8-testing-the-views-for-routing" title="Link to this heading">¶</a></h3>
<a class="reference internal image-reference" href="../_images/ch7-e3.png"><img alt="From the |ch7_place_1| to the |ch7_place_2|" src="../_images/ch7-e3.png" style="width: 388.0px; height: 218.5px;" />
</a>
<p class="rubric">Problem</p>
<ul class="simple">
<li><p>Test the created views</p></li>
</ul>
<p>In particular:</p>
<ul class="simple">
<li><p>From the Estação das Docas to the “Hangar Convention Center using the OSM identifier</p></li>
<li><p>the views to be tested are:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">vehicle_net</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">taxi_net</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">walk_net</span></code></p></li>
</ul>
</li>
<li><p>Only show the following results, as the other columns are to be ignored on the function.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">seq</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">edge</span></code> with the name <code class="docutils literal notranslate"><span class="pre">id</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cost</span></code> with the name: <code class="docutils literal notranslate"><span class="pre">seconds</span></code></p></li>
</ul>
</li>
</ul>
<p class="rubric">Solution</p>
<ul class="simple">
<li><p>In general</p>
<ul>
<li><p>The departure is Estação das Docas with OSM identifier <code class="docutils literal notranslate"><span class="pre">5661895682</span></code>.</p></li>
<li><p>The destination is Hangar Convention Center with OSM identifier <code class="docutils literal notranslate"><span class="pre">10982869752</span></code>.</p></li>
</ul>
</li>
</ul>
<p>For <code class="docutils literal notranslate"><span class="pre">vehicle_net</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vehicle_net</span></code> is used.</p></li>
<li><p>Selection of the columns with the corresponding names are on line <strong>1</strong>.</p></li>
<li><p>The view is prepared with the column names that pgRouting use.</p>
<ul>
<li><p>There is no need to rename columns. (line <strong>3</strong>)</p></li>
</ul>
</li>
<li><p>The OSM identifiers of the departure and destination are used. (line <strong>4</strong>)</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="linenos">1</span><span class="k">SELECT</span><span class="w"> </span><span class="n">start_vid</span><span class="p">,</span><span class="w"> </span><span class="n">end_vid</span><span class="p">,</span><span class="w"> </span><span class="n">agg_cost</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">seconds</span>
</span><span class="linenos">2</span><span class="k">FROM</span><span class="w"> </span><span class="n">pgr_dijkstraCost</span><span class="p">(</span>
<span class="hll"><span class="linenos">3</span><span class="w">  </span><span class="s1">&#39;SELECT * FROM vehicle_net&#39;</span><span class="p">,</span>
</span><span class="hll"><span class="linenos">4</span><span class="w">  </span><span class="mi">5661895682</span><span class="p">,</span><span class="w"> </span><span class="mi">10982869752</span><span class="p">);</span>
</span></pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="e83d6278-9730-41c7-9f19-ba5d8892783b" name="e83d6278-9730-41c7-9f19-ba5d8892783b" type="checkbox"><label class="sphinx_collapse__label" for="e83d6278-9730-41c7-9f19-ba5d8892783b"><i class="sphinx_collapse__icon"></i>Query resultes</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">start_vid</span>  <span class="o">|</span>   <span class="n">end_vid</span>   <span class="o">|</span>      <span class="n">seconds</span>      
<span class="o">------------+-------------+-------------------</span>
 <span class="mi">5661895682</span> <span class="o">|</span> <span class="mi">10982869752</span> <span class="o">|</span> <span class="mf">465.6834621403192</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
<p>For <code class="docutils literal notranslate"><span class="pre">taxi_net</span></code>:</p>
<ul class="simple">
<li><p>Similar as the previous one but with <code class="docutils literal notranslate"><span class="pre">taxi_net</span></code>. (line <strong>3</strong>)</p></li>
<li><p>The results give the same route as with <code class="docutils literal notranslate"><span class="pre">vehicle_net</span></code> but <code class="docutils literal notranslate"><span class="pre">cost</span></code> is
higher.</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">start_vid</span><span class="p">,</span><span class="w"> </span><span class="n">end_vid</span><span class="p">,</span><span class="w"> </span><span class="n">agg_cost</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">seconds</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">pgr_dijkstraCost</span><span class="p">(</span>
<span class="hll"><span class="w">  </span><span class="s1">&#39;SELECT * FROM taxi_net&#39;</span><span class="p">,</span>
</span><span class="w">  </span><span class="mi">5661895682</span><span class="p">,</span><span class="w"> </span><span class="mi">10982869752</span><span class="p">);</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="dd091fcb-1e7a-4586-b2e6-c6263a9969a9" name="dd091fcb-1e7a-4586-b2e6-c6263a9969a9" type="checkbox"><label class="sphinx_collapse__label" for="dd091fcb-1e7a-4586-b2e6-c6263a9969a9"><i class="sphinx_collapse__icon"></i>Query resultes</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">start_vid</span>  <span class="o">|</span>   <span class="n">end_vid</span>   <span class="o">|</span>      <span class="n">seconds</span>      
<span class="o">------------+-------------+-------------------</span>
 <span class="mi">5661895682</span> <span class="o">|</span> <span class="mi">10982869752</span> <span class="o">|</span> <span class="mf">512.2518083543514</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
<p>For <code class="docutils literal notranslate"><span class="pre">walk_net</span></code>:</p>
<ul>
<li><p>Similar as the previous one but with <code class="docutils literal notranslate"><span class="pre">walk_net</span></code>. (line <strong>3</strong>)</p></li>
<li><p>The results give a different route than of the vehicles.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">start_vid</span><span class="p">,</span><span class="w"> </span><span class="n">end_vid</span><span class="p">,</span><span class="w"> </span><span class="n">agg_cost</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">seconds</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">pgr_dijkstraCost</span><span class="p">(</span>
<span class="hll"><span class="w">  </span><span class="s1">&#39;SELECT * FROM walk_net&#39;</span><span class="p">,</span>
</span><span class="w">  </span><span class="mi">5661895682</span><span class="p">,</span><span class="w"> </span><span class="mi">10982869752</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ul>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="e4691b09-8b28-43ab-b8f5-031b84961148" name="e4691b09-8b28-43ab-b8f5-031b84961148" type="checkbox"><label class="sphinx_collapse__label" for="e4691b09-8b28-43ab-b8f5-031b84961148"><i class="sphinx_collapse__icon"></i>Query resultes</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">start_vid</span> <span class="o">|</span> <span class="n">end_vid</span> <span class="o">|</span> <span class="n">seconds</span> 
<span class="o">-----------+---------+---------</span>
<span class="p">(</span><span class="mi">0</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2010-2024 pgRouting Developers.<br/>
      Last updated on Sep 28, 2025.<br/>
    </p>
  </div>
</footer>
  </body>
</html>