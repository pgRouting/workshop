<!DOCTYPE html>

<html lang="es" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>5. Ciudades y comunidades sostenibles &#8212; Workshop - FOSS4G Belém - Routing with pgRouting</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css?v=5a695559" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx_collapse.css?v=226d88b4" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=fa3951f0" />
    <script src="../_static/documentation_options.js?v=3b0b8565"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/translations.js?v=f85f4cfb"></script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="search" title="Búsqueda" href="../search.html" />
    <link rel="next" title="1. Uso de Qgis" href="../interactions/chapter-9.html" />
    <link rel="prev" title="4. Energía asequible y limpia" href="sdg7-energy.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="../_static/bootstrap-2.3.2/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>

  </head><body>

  <div id="navbar" class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>

        <a class="brand" href="../index.html">
          Workshop FOSS4G Belém</a>
        <span class="navbar-text pull-left"><b>3.0</b></span>

        <div class="nav-collapse">
          <ul class="nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://docs.pgrouting.org/latest/en/index.html">Documentation</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Chapters <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../general-intro/introduction.html">1. Introducción</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general-intro/osgeolive.html">2. OSGeoLive Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general-intro/overview.html">3. Software and Data Overview</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../basic/data.html">1. Preparar Datos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic/pedestrian.html">2. Enrutamiento peatonal</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic/vehicle.html">3. Enrutamiento de vehículos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic/graph_views.html">4. Vistas de grafos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic/sql_function.html">5. Función SQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic/plpgsql_function.html">6. Función pl/pgsql</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="data.html">1. Datos para los Objetivos de Desarrollo Sostenible</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">2. Alcanzar los Objetivos de Desarrollo Sostenible con pgRouting</a></li>
<li class="toctree-l1"><a class="reference internal" href="sdg3-health.html">3. Buena salud y bienestar</a></li>
<li class="toctree-l1"><a class="reference internal" href="sdg7-energy.html">4. Energía asequible y limpia</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">5. Ciudades y comunidades sostenibles</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../interactions/chapter-9.html">1. Uso de Qgis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interactions/chapter-10.html">2. Servidor WMS con GeoServer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interactions/chapter-11.html">3. Interfaz de Ruteo Basada en OpenLayers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/chapter-12.html">4. Crear una topología de red</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../examples/boost_dijkstra.html">1. Ejemplo de Boost Dijkstra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/hanoslav.html">2. Ejemplos del Internet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/wiki_example.html">3. Ejemplo de Wikipedia Dijkstra</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../appendix/appendix-2.html">1. Apéndice: Instalación</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/appendix-3.html">2. Apéndice: Herramienta de Importación osm2pgrouting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/appendix-4.html">3. Tutoriales en Video para Taller</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">5. Ciudades y comunidades sostenibles</a><ul>
<li><a class="reference internal" href="#problem-city-getting-affected-by-rain-or-not">5.1. Problema: Ciudad afectada por la lluvia o no</a></li>
<li><a class="reference internal" href="#choose-a-city">5.2. Eligir una ciudad</a><ul>
<li><a class="reference internal" href="#exercise-1-create-a-point-for-the-city">5.2.1. Ejercicio 1: Crear un punto para la ciudad</a></li>
</ul>
</li>
<li><a class="reference internal" href="#prepare-the-database">5.3. Preparar la base de datos</a><ul>
<li><a class="reference internal" href="#exercise-2-set-the-search-path">5.3.1. Exercise 2: Set the search path</a></li>
<li><a class="reference internal" href="#exercise-3-verify-database-configuration">5.3.2. Exercise 3: Verify database configuration</a><ul>
<li><a class="reference internal" href="#exercise-4-count-the-number-of-waterways">5.3.2.1. Exercise 4: Count the number of Waterways</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#processing-waterways-data">5.4. Processing waterways data</a><ul>
<li><a class="reference internal" href="#exercise-5-remove-waterways-not-for-the-problem">5.4.1. Exercise 5: Remove waterways not for the problem</a></li>
</ul>
</li>
<li><a class="reference internal" href="#exercise-6-get-the-connected-components-of-waterways">5.5. Exercise 6: Get the Connected Components of Waterways</a><ul>
<li><a class="reference internal" href="#exercise-7-creating-a-function-that-gets-the-city-buffer">5.5.1. Exercise 7: Creating a function that gets the city buffer</a></li>
</ul>
</li>
<li><a class="reference internal" href="#exercise-8-finding-the-components-intersecting-the-buffer">5.6. Exercise 8: Finding the components intersecting the buffer</a></li>
<li><a class="reference internal" href="#exercise-9-get-the-rain-zones">5.7. Exercise 9: Get the rain zones</a></li>
<li><a class="reference internal" href="#exercise-10-create-a-union-of-rain-zones">5.8. Exercise 10: Create a union of rain zones</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="sdg7-energy.html" title="Previous Chapter: 4. Energía asequible y limpia"><span class="icon-chevron-left visible-tablet"></span><span class="hidden-sm hidden-tablet">&laquo; 4. Energía as...</span>
    </a>
  </li>
  <li>
    <a href="../interactions/chapter-9.html" title="Next Chapter: 1. Uso de Qgis"><span class="icon-chevron-right visible-tablet"></span><span class="hidden-sm hidden-tablet">1. Uso de Qgis &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
      </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body span12 content" role="main">
      
  <section id="sustainable-cities-and-communities">
<h1><a class="toc-backref" href="#id1" role="doc-backlink"><span class="section-number">5. </span>Ciudades y comunidades sostenibles</a><a class="headerlink" href="#sustainable-cities-and-communities" title="Link to this heading">¶</a></h1>
<p>“Ciudades y Comunidades Sostenibles” es el 11º Objetivo de Desarrollo Sostenible que aspira a hacer que las ciudades sean «inclusivas, seguras, resilientes» y «sostenibles». El mundo se está urbanizando cada vez más. Desde 2007, más de la mitad de la población mundial vive en ciudades. Esto hace que sea muy importante que las ciudades permanezcan alertas cuando existe la posibilidad de desastres como inundaciones. La administración local debe saber si su ciudad se va a ver afectada por las lluvias que ocurren en sus proximidades para que puedan alertar a los ciudadanos. Este ejercicio resolverá uno de estos problemas.</p>
<img alt="Objetivo de Desarrollo Sostenible 11: Ciudades y Comunidades Sostenibles" class="align-center" src="../_images/un_sdg11.png" />
<p>“Fuente de la imagen &lt;<a class="reference external" href="https://sdgs.un.org/goals/goal11">https://sdgs.un.org/goals/goal11</a>&gt;`__</p>
<nav class="contents" id="chapter-contents">
<p class="topic-title">Contenido del Capítulo</p>
<ul class="simple">
<li><p><a class="reference internal" href="#sustainable-cities-and-communities" id="id1">Ciudades y comunidades sostenibles</a></p>
<ul>
<li><p><a class="reference internal" href="#problem-city-getting-affected-by-rain-or-not" id="id2">Problema: Ciudad afectada por la lluvia o no</a></p></li>
<li><p><a class="reference internal" href="#choose-a-city" id="id3">Eligir una ciudad</a></p>
<ul>
<li><p><a class="reference internal" href="#exercise-1-create-a-point-for-the-city" id="id4">Ejercicio 1: Crear un punto para la ciudad</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#prepare-the-database" id="id5">Preparar la base de datos</a></p>
<ul>
<li><p><a class="reference internal" href="#exercise-2-set-the-search-path" id="id6">Exercise 2: Set the search path</a></p></li>
<li><p><a class="reference internal" href="#exercise-3-verify-database-configuration" id="id7">Exercise 3: Verify database configuration</a></p>
<ul>
<li><p><a class="reference internal" href="#exercise-4-count-the-number-of-waterways" id="id8">Exercise 4: Count the number of Waterways</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#processing-waterways-data" id="id9">Processing waterways data</a></p>
<ul>
<li><p><a class="reference internal" href="#exercise-5-remove-waterways-not-for-the-problem" id="id10">Exercise 5: Remove waterways not for the problem</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#exercise-6-get-the-connected-components-of-waterways" id="id11">Exercise 6: Get the Connected Components of Waterways</a></p>
<ul>
<li><p><a class="reference internal" href="#exercise-7-creating-a-function-that-gets-the-city-buffer" id="id12">Exercise 7: Creating a function that gets the city buffer</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#exercise-8-finding-the-components-intersecting-the-buffer" id="id13">Exercise 8: Finding the components intersecting the buffer</a></p></li>
<li><p><a class="reference internal" href="#exercise-9-get-the-rain-zones" id="id14">Exercise 9: Get the rain zones</a></p></li>
<li><p><a class="reference internal" href="#exercise-10-create-a-union-of-rain-zones" id="id15">Exercise 10: Create a union of rain zones</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="problem-city-getting-affected-by-rain-or-not">
<h2><a class="toc-backref" href="#id2" role="doc-backlink"><span class="section-number">5.1. </span>Problema: Ciudad afectada por la lluvia o no</a><a class="headerlink" href="#problem-city-getting-affected-by-rain-or-not" title="Link to this heading">¶</a></h2>
<p><strong>Declaración del problema</strong></p>
<p>Determinar las áreas donde si llueve afectará a una ciudad/pueblo</p>
<a class="reference internal image-reference" href="../_images/sdg11_output.png"><img alt="../_images/sdg11_output.png" class="align-center" src="../_images/sdg11_output.png" style="width: 413.5px; height: 254.0px;" />
</a>
<p><strong>Idea central</strong></p>
<p>Si llueve en las cercanías de un río que conecta la ciudad, la ciudad se verá afectada por las lluvias.</p>
<p><strong>Enfoque</strong></p>
<ul class="simple">
<li><p>Eligir una ciudad</p></li>
<li><p>Obtener los ríos (segmentos)</p></li>
<li><p>Crear componentes fluviales</p></li>
<li><p>Crear una zona límite alrededor de la ciudad</p></li>
<li><p>Encontrar los componentes que intersectan la zona limitada</p></li>
<li><p>Encontrar las zonas de lluvia</p></li>
</ul>
</section>
<section id="choose-a-city">
<h2><a class="toc-backref" href="#id3" role="doc-backlink"><span class="section-number">5.2. </span>Eligir una ciudad</a><a class="headerlink" href="#choose-a-city" title="Link to this heading">¶</a></h2>
<p>Para este ejercicio, se elige la ciudad de Munshigang de Bangladesh. Esta ciudad tiene múltiples ríos en su proximidad, lo que la convierte en un lugar adecuado para demostrar este ejercicio. El ejercicio tratará de encontrar las zonas, donde si llueve la ciudad se verá afectada. Para definir la ubicación de esta ciudad y usarla en pasos posteriores, crear una tabla para almacenar el nombre junto con los valores de latitud y longitud de la ubicación de la ciudad. Esto almacena la ciudad como un punto.</p>
<section id="exercise-1-create-a-point-for-the-city">
<h3><a class="toc-backref" href="#id4" role="doc-backlink"><span class="section-number">5.2.1. </span>Ejercicio 1: Crear un punto para la ciudad</a><a class="headerlink" href="#exercise-1-create-a-point-for-the-city" title="Link to this heading">¶</a></h3>
<p class="rubric">Create a table for the cities</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">bangladesh</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span>
<span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">  </span><span class="n">geom</span><span class="w"> </span><span class="n">geometry</span><span class="p">,</span>
<span class="w">  </span><span class="n">city_buffer</span><span class="w"> </span><span class="n">geometry</span>
<span class="p">);</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="afc81c79-0ccf-4f06-81e3-19d6f5b981a8" name="afc81c79-0ccf-4f06-81e3-19d6f5b981a8" type="checkbox"><label class="sphinx_collapse__label" for="afc81c79-0ccf-4f06-81e3-19d6f5b981a8"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">TABLE</span>
</pre></div>
</div>
</div>
</div>
<p class="rubric">Insert Munshigang</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">bangladesh</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">geom</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span>
<span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Munshigang&#39;</span><span class="p">,</span><span class="w">  </span><span class="n">ST_SetSRID</span><span class="p">(</span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">89</span><span class="p">.</span><span class="mi">1967</span><span class="p">,</span><span class="w"> </span><span class="mi">22</span><span class="p">.</span><span class="mi">2675</span><span class="p">),</span><span class="w"> </span><span class="mi">4326</span><span class="p">));</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="cfaa664b-57b8-4807-81ce-2a150eb4b00c" name="cfaa664b-57b8-4807-81ce-2a150eb4b00c" type="checkbox"><label class="sphinx_collapse__label" for="cfaa664b-57b8-4807-81ce-2a150eb4b00c"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INSERT</span> <span class="mi">0</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<p class="rubric">Simulate the city region with a buffer</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span><span class="w"> </span><span class="n">bangladesh</span>
<span class="k">SET</span><span class="w"> </span><span class="n">city_buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ST_Buffer</span><span class="p">((</span><span class="n">geom</span><span class="p">),</span><span class="mi">0</span><span class="p">.</span><span class="mi">005</span><span class="p">)</span>
<span class="k">WHERE</span><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Munshigang&#39;</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="a85eee7a-962f-4c7a-afd1-e6185e028896" name="a85eee7a-962f-4c7a-afd1-e6185e028896" type="checkbox"><label class="sphinx_collapse__label" for="a85eee7a-962f-4c7a-afd1-e6185e028896"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UPDATE</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<p class="rubric">See description of the table</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">dS</span><span class="o">+</span> <span class="n">bangladesh</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="c5fdc86a-5a14-4f0e-a0dc-ded3465da37b" name="c5fdc86a-5a14-4f0e-a0dc-ded3465da37b" type="checkbox"><label class="sphinx_collapse__label" for="c5fdc86a-5a14-4f0e-a0dc-ded3465da37b"><i class="sphinx_collapse__icon"></i>Command results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                                           <span class="n">Table</span> <span class="s2">&quot;public.bangladesh&quot;</span>
   <span class="n">Column</span>    <span class="o">|</span>   <span class="n">Type</span>   <span class="o">|</span> <span class="n">Collation</span> <span class="o">|</span> <span class="n">Nullable</span> <span class="o">|</span> <span class="n">Default</span> <span class="o">|</span> <span class="n">Storage</span>  <span class="o">|</span> <span class="n">Compression</span> <span class="o">|</span> <span class="n">Stats</span> <span class="n">target</span> <span class="o">|</span> <span class="n">Description</span> 
<span class="o">-------------+----------+-----------+----------+---------+----------+-------------+--------------+-------------</span>
 <span class="nb">id</span>          <span class="o">|</span> <span class="n">bigint</span>   <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
 <span class="n">name</span>        <span class="o">|</span> <span class="n">text</span>     <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">extended</span> <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
 <span class="n">geom</span>        <span class="o">|</span> <span class="n">geometry</span> <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">main</span>     <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
 <span class="n">city_buffer</span> <span class="o">|</span> <span class="n">geometry</span> <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">main</span>     <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
<span class="n">Access</span> <span class="n">method</span><span class="p">:</span> <span class="n">heap</span>

</pre></div>
</div>
</div>
</div>
<p>Los valores de latitud y longitud se convierten en <code class="docutils literal notranslate"><span class="pre">geometry</span></code> usando <code class="docutils literal notranslate"><span class="pre">ST_Point</span></code> que devuelve un punto con los valores de coordenadas X e Y dados. <code class="docutils literal notranslate"><span class="pre">ST_SetSRID</span></code> se utiliza para establecer el SRID (Identificado de referencia Espacial) en la geometría del punto en <code class="docutils literal notranslate"><span class="pre">4326</span></code>.</p>
</section>
</section>
<section id="prepare-the-database">
<h2><a class="toc-backref" href="#id5" role="doc-backlink"><span class="section-number">5.3. </span>Preparar la base de datos</a><a class="headerlink" href="#prepare-the-database" title="Link to this heading">¶</a></h2>
<p>Data obtained in <a class="reference internal" href="data.html"><span class="doc">Datos para los Objetivos de Desarrollo Sostenible</span></a>.</p>
<p>This section will cover the status of the database in order to get the same
results when processing the queries.</p>
<section id="exercise-2-set-the-search-path">
<h3><a class="toc-backref" href="#id6" role="doc-backlink"><span class="section-number">5.3.1. </span>Exercise 2: Set the search path</a><a class="headerlink" href="#exercise-2-set-the-search-path" title="Link to this heading">¶</a></h3>
<p>El primer paso en el preprocesamiento es establecer la ruta de búsqueda para los datos de <code class="docutils literal notranslate"><span class="pre">Waterways</span></code>. La ruta de búsqueda es una lista de esquemas que ayuda al sistema a determinar cómo se va a importar una tabla en particular.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SET</span><span class="w"> </span><span class="n">search_path</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">waterways</span><span class="p">,</span><span class="k">public</span><span class="p">;</span>
<span class="k">SHOW</span><span class="w"> </span><span class="n">search_path</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="f26da1ae-1af0-4f11-821f-4c66c0f4e1e9" name="f26da1ae-1af0-4f11-821f-4c66c0f4e1e9" type="checkbox"><label class="sphinx_collapse__label" for="f26da1ae-1af0-4f11-821f-4c66c0f4e1e9"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SET</span>
    <span class="n">search_path</span>    
<span class="o">-------------------</span>
 <span class="n">waterways</span><span class="p">,</span> <span class="n">public</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
</section>
<section id="exercise-3-verify-database-configuration">
<h3><a class="toc-backref" href="#id7" role="doc-backlink"><span class="section-number">5.3.2. </span>Exercise 3: Verify database configuration</a><a class="headerlink" href="#exercise-3-verify-database-configuration" title="Link to this heading">¶</a></h3>
<p>As part of the every project tasks: inspect the database structure.</p>
<p class="rubric">Get the extensions that are installed</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">dx</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="c0c324ed-8a2f-4861-ae74-d2a33d046df2" name="c0c324ed-8a2f-4861-ae74-d2a33d046df2" type="checkbox"><label class="sphinx_collapse__label" for="c0c324ed-8a2f-4861-ae74-d2a33d046df2"><i class="sphinx_collapse__icon"></i>Command results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                                 <span class="n">List</span> <span class="n">of</span> <span class="n">installed</span> <span class="n">extensions</span>
   <span class="n">Name</span>    <span class="o">|</span> <span class="n">Version</span> <span class="o">|</span>   <span class="n">Schema</span>   <span class="o">|</span>                        <span class="n">Description</span>                         
<span class="o">-----------+---------+------------+------------------------------------------------------------</span>
 <span class="n">hstore</span>    <span class="o">|</span> <span class="mf">1.8</span>     <span class="o">|</span> <span class="n">public</span>     <span class="o">|</span> <span class="n">data</span> <span class="nb">type</span> <span class="k">for</span> <span class="n">storing</span> <span class="n">sets</span> <span class="n">of</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="n">pairs</span>
 <span class="n">pgrouting</span> <span class="o">|</span> <span class="mf">3.7.2</span>   <span class="o">|</span> <span class="n">public</span>     <span class="o">|</span> <span class="n">pgRouting</span> <span class="n">Extension</span>
 <span class="n">plpgsql</span>   <span class="o">|</span> <span class="mf">1.0</span>     <span class="o">|</span> <span class="n">pg_catalog</span> <span class="o">|</span> <span class="n">PL</span><span class="o">/</span><span class="n">pgSQL</span> <span class="n">procedural</span> <span class="n">language</span>
 <span class="n">postgis</span>   <span class="o">|</span> <span class="mf">3.5.2</span>   <span class="o">|</span> <span class="n">public</span>     <span class="o">|</span> <span class="n">PostGIS</span> <span class="n">geometry</span> <span class="ow">and</span> <span class="n">geography</span> <span class="n">spatial</span> <span class="n">types</span> <span class="ow">and</span> <span class="n">functions</span>
<span class="p">(</span><span class="mi">4</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
<p class="rubric">List installed tables</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">dt</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="4fed767f-4a8d-4a92-8e34-2f7c5909684c" name="4fed767f-4a8d-4a92-8e34-2f7c5909684c" type="checkbox"><label class="sphinx_collapse__label" for="4fed767f-4a8d-4a92-8e34-2f7c5909684c"><i class="sphinx_collapse__icon"></i>Command results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                    <span class="n">List</span> <span class="n">of</span> <span class="n">relations</span>
  <span class="n">Schema</span>   <span class="o">|</span>            <span class="n">Name</span>             <span class="o">|</span> <span class="n">Type</span>  <span class="o">|</span> <span class="n">Owner</span>  
<span class="o">-----------+-----------------------------+-------+--------</span>
 <span class="n">public</span>    <span class="o">|</span> <span class="n">bangladesh</span>                  <span class="o">|</span> <span class="n">table</span> <span class="o">|</span> <span class="n">runner</span>
 <span class="n">public</span>    <span class="o">|</span> <span class="n">spatial_ref_sys</span>             <span class="o">|</span> <span class="n">table</span> <span class="o">|</span> <span class="n">runner</span>
 <span class="n">waterways</span> <span class="o">|</span> <span class="n">configuration</span>               <span class="o">|</span> <span class="n">table</span> <span class="o">|</span> <span class="n">user</span>
 <span class="n">waterways</span> <span class="o">|</span> <span class="n">waterways_pointsofinterest</span>  <span class="o">|</span> <span class="n">table</span> <span class="o">|</span> <span class="n">user</span>
 <span class="n">waterways</span> <span class="o">|</span> <span class="n">waterways_ways</span>              <span class="o">|</span> <span class="n">table</span> <span class="o">|</span> <span class="n">user</span>
 <span class="n">waterways</span> <span class="o">|</span> <span class="n">waterways_ways_vertices_pgr</span> <span class="o">|</span> <span class="n">table</span> <span class="o">|</span> <span class="n">user</span>
<span class="p">(</span><span class="mi">6</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
<section id="exercise-4-count-the-number-of-waterways">
<h4><a class="toc-backref" href="#id8" role="doc-backlink"><span class="section-number">5.3.2.1. </span>Exercise 4: Count the number of Waterways</a><a class="headerlink" href="#exercise-4-count-the-number-of-waterways" title="Link to this heading">¶</a></h4>
<p>La importancia de contar la información en este taller es asegurarse de que se utilizan los mismos datos y, en consecuencia, los resultados son los mismos. Además, algunas de las filas se pueden ver para comprender la estructura de la tabla y cómo se almacenan los datos en ella.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">waterways_ways</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="7d0d6aa0-635c-4119-9a6f-829ad2fb6c66" name="7d0d6aa0-635c-4119-9a6f-829ad2fb6c66" type="checkbox"><label class="sphinx_collapse__label" for="7d0d6aa0-635c-4119-9a6f-829ad2fb6c66"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">count</span> 
<span class="o">-------</span>
   <span class="mi">815</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="processing-waterways-data">
<h2><a class="toc-backref" href="#id9" role="doc-backlink"><span class="section-number">5.4. </span>Processing waterways data</a><a class="headerlink" href="#processing-waterways-data" title="Link to this heading">¶</a></h2>
<p>This section will work the graph that is going to be used for processing. While
building the graph, the data has to be inspected to determine if there is any
invalid data. This is a very important step to make sure that the data is of
required quality. pgRouting can also be used to do some Data Adjustments.</p>
<section id="exercise-5-remove-waterways-not-for-the-problem">
<h3><a class="toc-backref" href="#id10" role="doc-backlink"><span class="section-number">5.4.1. </span>Exercise 5: Remove waterways not for the problem</a><a class="headerlink" href="#exercise-5-remove-waterways-not-for-the-problem" title="Link to this heading">¶</a></h3>
<img alt="Waterways to be removed" class="align-center" src="../_images/remove_waterways.png" />
<p>This exercise focusses only the areas in the mainland, where if it rains the city is
affected. Hence, the rivers which are there in the swamp area wich is in a lower
altitude of the city, are to be removed from the <code class="docutils literal notranslate"><span class="pre">waterways_ways</span></code> table.</p>
<p class="rubric">Remove swamp rivers</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">waterways_ways</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">osm_id</span>
<span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="mi">721133202</span><span class="p">,</span><span class="w"> </span><span class="mi">908102930</span><span class="p">,</span><span class="w"> </span><span class="mi">749173392</span><span class="p">,</span><span class="w"> </span><span class="mi">652172284</span><span class="p">,</span><span class="w"> </span><span class="mi">126774195</span><span class="p">,</span><span class="w"> </span><span class="mi">720395312</span><span class="p">);</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="44131f73-b222-45cb-b39b-7872e22a070b" name="44131f73-b222-45cb-b39b-7872e22a070b" type="checkbox"><label class="sphinx_collapse__label" for="44131f73-b222-45cb-b39b-7872e22a070b"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DELETE</span> <span class="mi">31</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>When working for many cities, a better approach might be to create
views.</p>
</div>
<p class="rubric">Also delete a boundary tagged as waterway</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">waterways_ways</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">osm_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">815893446</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="14ad6f82-209f-4841-8725-20b3acd9c896" name="14ad6f82-209f-4841-8725-20b3acd9c896" type="checkbox"><label class="sphinx_collapse__label" for="14ad6f82-209f-4841-8725-20b3acd9c896"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DELETE</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>A better approach might be to fix the original data in OSM website.</p>
</div>
</section>
</section>
<section id="exercise-6-get-the-connected-components-of-waterways">
<h2><a class="toc-backref" href="#id11" role="doc-backlink"><span class="section-number">5.5. </span>Exercise 6: Get the Connected Components of Waterways</a><a class="headerlink" href="#exercise-6-get-the-connected-components-of-waterways" title="Link to this heading">¶</a></h2>
<p>Como los ríos en los datos no tienen un solo segmento, es decir, múltiples segmentos forman un río, es importante encontrar los segmentos conectados y almacenar la información en la tabla <code class="docutils literal notranslate"><span class="pre">waterways_ways</span></code>. Esto ayudará a identificar cuáles segmentos pertenecen a un río. Primero se encuentran los componentes conectados y luego se almacenan en una nueva columna llamada <code class="docutils literal notranslate"><span class="pre">component</span></code>.</p>
<p>The pgRouting function <code class="docutils literal notranslate"><span class="pre">pgr_connectedComponents</span></code> is used to complete this task
and its explaind with more detail in <a class="reference internal" href="../basic/graph_views.html"><span class="doc">Vistas de grafos</span></a>.</p>
<p>A sub-query is created to find out all the connected components. After that,
the <code class="docutils literal notranslate"><span class="pre">component</span></code> column is updated using the results obtained from the sub-query.
This helps in storing the component id in the <code class="docutils literal notranslate"><span class="pre">waterways_ways_vertices_pgr</span></code> table.
Next query uses this output and stores the component id in the waterways_ways
(edges) table. Follow the steps given below to complete this task.</p>
<p class="rubric">Crear una tabla de vértices.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">waterways</span><span class="p">.</span><span class="n">waterways_vertices</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">pgr_extractVertices</span><span class="p">(</span>
<span class="w">  </span><span class="s1">&#39;SELECT gid AS id, source, target</span>
<span class="s1">  FROM waterways.waterways_ways ORDER BY id&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="1be632b4-09f9-41e5-be6e-a8b76feae344" name="1be632b4-09f9-41e5-be6e-a8b76feae344" type="checkbox"><label class="sphinx_collapse__label" for="1be632b4-09f9-41e5-be6e-a8b76feae344"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="mi">777</span>
</pre></div>
</div>
</div>
</div>
<p class="rubric">Llenar las columnas <code class="docutils literal notranslate"><span class="pre">x</span></code>, <code class="docutils literal notranslate"><span class="pre">y</span></code> y <code class="docutils literal notranslate"><span class="pre">geom</span></code>.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span><span class="w"> </span><span class="n">waterways_vertices</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">geom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ST_startPoint</span><span class="p">(</span><span class="n">the_geom</span><span class="p">)</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">waterways_ways</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>

<span class="k">UPDATE</span><span class="w"> </span><span class="n">waterways_vertices</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">geom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ST_endPoint</span><span class="p">(</span><span class="n">the_geom</span><span class="p">)</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">waterways_ways</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">geom</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>

<span class="k">UPDATE</span><span class="w"> </span><span class="n">waterways_vertices</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ST_X</span><span class="p">(</span><span class="n">geom</span><span class="p">),</span><span class="w"> </span><span class="n">ST_Y</span><span class="p">(</span><span class="n">geom</span><span class="p">));</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="d496fded-bfaa-48e0-8c51-7e4f03a2593e" name="d496fded-bfaa-48e0-8c51-7e4f03a2593e" type="checkbox"><label class="sphinx_collapse__label" for="d496fded-bfaa-48e0-8c51-7e4f03a2593e"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UPDATE</span> <span class="mi">656</span>
<span class="n">UPDATE</span> <span class="mi">121</span>
<span class="n">UPDATE</span> <span class="mi">777</span>
</pre></div>
</div>
</div>
</div>
<p class="rubric">Añadir una columna <code class="docutils literal notranslate"><span class="pre">component</span></code> en las tablas de aristas y vértices.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">waterways_ways</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">;</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">waterways_vertices</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="22dedec0-5fcc-479e-b41e-13f16155fafa" name="22dedec0-5fcc-479e-b41e-13f16155fafa" type="checkbox"><label class="sphinx_collapse__label" for="22dedec0-5fcc-479e-b41e-13f16155fafa"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ALTER</span> <span class="n">TABLE</span>
<span class="n">ALTER</span> <span class="n">TABLE</span>
</pre></div>
</div>
</div>
</div>
<p class="rubric">Llenar la columna <code class="docutils literal notranslate"><span class="pre">component</span></code> de la tabla de vértices.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span><span class="w"> </span><span class="n">waterways_vertices</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">component</span>
<span class="k">FROM</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">pgr_connectedComponents</span><span class="p">(</span>
<span class="w">  </span><span class="s1">&#39;SELECT gid as id, source, target, cost, reverse_cost FROM waterways_ways&#39;</span><span class="p">)</span>
<span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">c</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="4ffd2d12-5d67-4ba4-bb6e-5fa5d886b08c" name="4ffd2d12-5d67-4ba4-bb6e-5fa5d886b08c" type="checkbox"><label class="sphinx_collapse__label" for="4ffd2d12-5d67-4ba4-bb6e-5fa5d886b08c"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UPDATE</span> <span class="mi">777</span>
</pre></div>
</div>
</div>
</div>
<p class="rubric">Llenar la columna <code class="docutils literal notranslate"><span class="pre">component</span></code> de la tabla de aristas.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span><span class="w"> </span><span class="n">waterways_ways</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">component</span>
<span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">waterways_vertices</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">v</span>
<span class="k">WHERE</span><span class="w"> </span><span class="k">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">id</span><span class="p">;</span>
</pre></div>
</div>
<section id="exercise-7-creating-a-function-that-gets-the-city-buffer">
<h3><a class="toc-backref" href="#id12" role="doc-backlink"><span class="section-number">5.5.1. </span>Exercise 7: Creating a function that gets the city buffer</a><a class="headerlink" href="#exercise-7-creating-a-function-that-gets-the-city-buffer" title="Link to this heading">¶</a></h3>
<p>Se puede crear una función para la misma tarea. Esto será de ayuda cuando la tabla tenga más de una ciudad.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">get_city_buffer</span><span class="p">(</span><span class="n">city_id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">)</span>
<span class="k">RETURNS</span><span class="w"> </span><span class="n">geometry</span><span class="w"> </span><span class="k">AS</span>
<span class="err">$</span><span class="n">BODY$</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">city_buffer</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">bangladesh</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">city_id</span><span class="p">;</span>
<span class="err">$</span><span class="n">BODY$</span>
<span class="k">LANGUAGE</span><span class="w"> </span><span class="k">SQL</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="49606bb7-a650-453c-b2ea-070d0586495d" name="49606bb7-a650-453c-b2ea-070d0586495d" type="checkbox"><label class="sphinx_collapse__label" for="49606bb7-a650-453c-b2ea-070d0586495d"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">FUNCTION</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="exercise-8-finding-the-components-intersecting-the-buffer">
<h2><a class="toc-backref" href="#id13" role="doc-backlink"><span class="section-number">5.6. </span>Exercise 8: Finding the components intersecting the buffer</a><a class="headerlink" href="#exercise-8-finding-the-components-intersecting-the-buffer" title="Link to this heading">¶</a></h2>
<p>El siguiente paso es encontrar los componentes de las vías fluviales que se encuentran dentro de la zona límite de la ciudad. Estos son los flujos de agua que afectarán a la ciudad cuando llueva a su alrededor. Esto se hace usando <code class="docutils literal notranslate"><span class="pre">ST_Intersects</span></code>. Tenga en cuenta que la función “<code class="docutils literal notranslate"><span class="pre">get_city_buffer</span></code> se utiliza en la consulta a continuación.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">component</span>
<span class="linenos">2</span><span class="k">FROM</span><span class="w"> </span><span class="n">bangladesh</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">waterways</span><span class="p">.</span><span class="n">waterways_ways</span>
<span class="linenos">3</span><span class="k">ON</span><span class="w"> </span><span class="p">(</span><span class="n">ST_Intersects</span><span class="p">(</span><span class="n">the_geom</span><span class="p">,</span><span class="w"> </span><span class="n">get_city_buffer</span><span class="p">(</span><span class="mi">5</span><span class="p">)));</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="c32fe6ce-f203-4908-9e4a-48f9a7893997" name="c32fe6ce-f203-4908-9e4a-48f9a7893997" type="checkbox"><label class="sphinx_collapse__label" for="c32fe6ce-f203-4908-9e4a-48f9a7893997"><i class="sphinx_collapse__icon"></i>Command result</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">component</span> 
<span class="o">-----------</span>
         <span class="mi">8</span>
        <span class="mi">57</span>
        <span class="mi">62</span>
<span class="p">(</span><span class="mi">3</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
<p>Output shows the distinct component numbers which lie in the buffer zone of the city.
That is, the rivers that lie within the city.</p>
</section>
<section id="exercise-9-get-the-rain-zones">
<h2><a class="toc-backref" href="#id14" role="doc-backlink"><span class="section-number">5.7. </span>Exercise 9: Get the rain zones</a><a class="headerlink" href="#exercise-9-get-the-rain-zones" title="Link to this heading">¶</a></h2>
<p>In this excercise the area , where if it rains, the
city would be affected, is calculated. This area is called <code class="docutils literal notranslate"><span class="pre">rain</span> <span class="pre">zone</span></code> in the excercise</p>
<p>Crear una zona límite alrededor de los rios.</p>
<ul class="simple">
<li><p>Add columns named <code class="docutils literal notranslate"><span class="pre">rain_zone</span></code> in waterways_ways</p>
<ul>
<li><p>Almacenamiento de la geometría de zona límite de lluvias.</p></li>
</ul>
</li>
<li><p>Find the buffer for every edge that intersects the city buffer area using <code class="docutils literal notranslate"><span class="pre">ST_Buffer</span></code></p></li>
<li><p>and update the <code class="docutils literal notranslate"><span class="pre">rain_zone</span></code> column.</p></li>
</ul>
<p class="rubric">Agregar columna para almacenar la geometría de zona límite</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">waterways_ways</span>
<span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">rain_zone</span><span class="w"> </span><span class="n">geometry</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="f29c6577-6472-48ed-b31c-9b61e8800517" name="f29c6577-6472-48ed-b31c-9b61e8800517" type="checkbox"><label class="sphinx_collapse__label" for="f29c6577-6472-48ed-b31c-9b61e8800517"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ALTER</span> <span class="n">TABLE</span>
</pre></div>
</div>
</div>
</div>
<p class="rubric">Almacenamiento de la geometría de zona límite</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span><span class="w"> </span><span class="n">waterways</span><span class="p">.</span><span class="n">waterways_ways</span>
<span class="k">SET</span><span class="w"> </span><span class="n">rain_zone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ST_Buffer</span><span class="p">((</span><span class="n">the_geom</span><span class="p">),</span><span class="mi">0</span><span class="p">.</span><span class="mi">005</span><span class="p">)</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">ST_Intersects</span><span class="p">(</span><span class="n">the_geom</span><span class="p">,</span><span class="w"> </span><span class="n">get_city_buffer</span><span class="p">(</span><span class="mi">5</span><span class="p">));</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="c5012d38-3172-4cd8-811c-e19a21d3e66f" name="c5012d38-3172-4cd8-811c-e19a21d3e66f" type="checkbox"><label class="sphinx_collapse__label" for="c5012d38-3172-4cd8-811c-e19a21d3e66f"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UPDATE</span> <span class="mi">5</span>
</pre></div>
</div>
</div>
</div>
<p>Esto nos dará la zona requerida, donde si llueve, la ciudad se verá afectada.</p>
</section>
<section id="exercise-10-create-a-union-of-rain-zones">
<h2><a class="toc-backref" href="#id15" role="doc-backlink"><span class="section-number">5.8. </span>Exercise 10: Create a union of rain zones</a><a class="headerlink" href="#exercise-10-create-a-union-of-rain-zones" title="Link to this heading">¶</a></h2>
<p>Los polígonos múltiples que se obtienen también se pueden fusionar usando “<code class="docutils literal notranslate"><span class="pre">ST_Union</span></code>. Esto dará un solo polígono como salida.</p>
<a class="reference internal image-reference" href="../_images/sdg11_output.png"><img alt="../_images/sdg11_output.png" class="align-center" src="../_images/sdg11_output.png" style="width: 413.5px; height: 254.0px;" />
</a>
<p>When it rains in the vicinity, the city will get affected by the rain.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Combining mutliple rain zones</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">ST_Union</span><span class="p">(</span><span class="n">rain_zone</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Combined_Rain_Zone</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">waterways_ways</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="4dd857c9-e685-4f33-addc-6cb643ad790c" name="4dd857c9-e685-4f33-addc-6cb643ad790c" type="checkbox"><label class="sphinx_collapse__label" for="4dd857c9-e685-4f33-addc-6cb643ad790c"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         <span class="n">combined_rain_zone</span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
<span class="o">--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
 <span class="mf">0103000020E6100000010000007</span><span class="n">C0000005DC25946634C56408ABF87BDBD423640C1A237A6584C5640303DDDE7ED423640249BBB93504C56408102F66F25433640F39C4F5E4B4C56401601813362433640BDC63139494C56409AC7B3DCA1433640FB447C394A4C5640E98843F9E14336400968C5394A4C564015E594FDE14336405F1DD849404C56403A5577EED7433640ACA22AF92F4C564083775044CE433640D1D14BCE164C5640F1C9219DC94336400CF50F290A4C56405E7E1330CB433640F3418FC4F44B5640AC581E80D4433640E509D39DEE4B5640C765B120D8433640CA514196DF4B56404EC10A56E3433640066B34B9D04B5640610AF3DFEA4336402FC1DF4DC54B564085CAD719ED433640C9591B3ABF4B5640F1E5EA48EE43364011DAB3B9AA4B56401E9B1316E9433640BE268DB4A24B564099AAB1BFE4433640AC3A89729B4B564051CAA489DE433640C9676CB4874B5640BA0527F0C74336401D40D2D86E4B5640F5AA9FCDA743364014C5557C604B564048EB3A3E924336401B7C4CF8504B56404624C5AC814336407E94B7F1404B5640EA8B6E887D43364041FE3F06314B56408EACF6F9854336402BE983D2214B564021834CAE9A433640B4F811EC134B564006B3BFD9BA43364084EEA9DB074B5640F666D43FE54336405A56FB17FE4A5640FADC6C3F18443640ABE61501F74A564095F6D0E251443640EB74B8DCF24A5640761AF6F28F443640D4CEA2D3F14A5640EBB8490DD0443640FDD604F0F34A5640DF1128BB0F453640A24C1A1DF94A56403866188A4C4536409B18F727014B56401328E0238445364097457CC10B4B5640D4508065B445364018636281184B56407BB13A74DB4536407E693BEA264B56403670D0CFF7453640343BE10E374B56402A58070C104636405459A9A63A4B56400C80311015463640C281CAA3564B5640BDF1E43E3946364078E51B4B594B564073FD897A3C463640F5CA020C714B5640D1EB67AB57463640B85E8172764B564048DC8A105D463640A6DC2B7D834B56407ECAB339684636407F5FBFA6894B564018D4AA856C463640EFA1E0A8974B5640430C1D19744636402951FB739D4B5640218571657646364062D98771B94B56406B7A6A7E7D4636409400739CC24B5640490E28C37D463640358E8546CD4B5640AF9751AF7B463640752D47DEDB4B564073A90BD7784636405D4B742FE24B5640717C28A0764636403B00E98FF64B5640BE24644A6C463640E5FE8A45FB4B56405FEEBE57694636408B333996094C56408A85C9AA5E46364028093C94154C56408EFB5772594636402DD4F420204C5640FED3A9655B463640F01C7BFF234C564029EF54505F46364060D541A42D4C5640C6ACEE726B46364038A83343404C5640D1063783864636407C91432C444C564062D10EC18B463640F1E3EC4F554C5640B6CDEED2A046364056D33CEC574C564026C237D8A34636406B23E593674C56403BC78CD6B4463640CB6FC0B6784C5640ECFC01D2BF46364068083B0B8A4C5640D239E01DBC4636401329E60B8E4C5640D902888AB9463640EE58623E9D4C5640D0F651A9A9463640D6996367AB4C56403533C3788E463640A35FA501B84C56406FA6C0F868463640B115469BB94C5640CDE9CF2D63463640FEDD7DE9BA4C564001298A6D60463640D2EE2B65BF4C56406C47E19954463640060C5C59C34C56408751C0984B463640FECDFD33CD4C564065D752343146364061FA2B1DD14C56404EEE67002546364042FC43BFDC4C5640A8D0CEB7F8453640379138FFE54C56402FDB0C35C4453640CFED0982EC4C5640AC0CBB7C89453640D205AA07F04C5640366688D04A453640B3F8C816F04C564075054D4641453640ADC20E1FF44C564009C0211D39453640A1783163FA4C564095CBB6B83F453640EE5D946A0A4D5640BF8101AA43453640DEA158541A4D564016D8C7053B45364054CFF083294D5640D3890D21264536401EFEF663374D56408C085FC905453640C097EA6B434D56409B4FEB3CDB4436401B3E6F254D4D5640349F491EA84436407C38D930544D56407C6A63646E443640A5A7DA48584D5640FDB920473044364030552D45594D5640C7249529F0433640C5EA1E1C574D564007158482B0433640F0E231EB554D56409B1855719C4336406FB56626504D56408BED70085B433640B04D9011474D56409DC508F21F4336408DDF41EC434D56409FE8DCA30F4336403A7F09153B4D5640A3D8D3B8E84236404163826B394D564059E12B6DE3423640223BE9713A4D56404CCC6847CE42364076D4BABE3B4D56404370292C794236402F6D104D3B4D5640142EC2A35F4236409B072C9F384D5640DB07B14D20423640453BA8E7324D5640C2BF6A46E441364073FFC25E2A4D5640EB9A7DDCAD413640F33073581F4D564031543B277F413640FF882E41124D564052AC26F259413640D197BE99034D5640B5C64AAB3F4136402DC44DF2F34C5640910C2A55314136408E00DDE4E34C5640E7F9CE7C2F41364000B7580FD44C5640389060343A413640F924870DC54C564091C16F1251413640C4DB0B73B74C5640D7B0043673413640154ABBC5AB4C5640D6EA434F9F4136401D207678A24C5640A98A56ACD341364030D41C0D9C4C56406499C0F30C423640F5D774EB904C564041E0C04F29423640F15AF7E28B4C5640153E3F9C39423640E251EE19814C5640FFDB62A963423640323E840C7D4C5640CECF25AB764236405F7A990B704C56403494CECA964236405DC25946634C56408ABF87BDBD423640</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2010-2024 pgRouting Developers.<br/>
      Actualizado por última vez en ene 24, 2025.<br/>
    </p>
  </div>
</footer>
  </body>
</html>