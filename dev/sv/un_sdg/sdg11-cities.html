<!DOCTYPE html>

<html lang="sv" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>5. Hållbara städer och samhällen &#8212; Workshop - FOSS4G Belém - Routing with pgRouting</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css?v=5a695559" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx_collapse.css?v=226d88b4" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=fa3951f0" />
    <script src="../_static/documentation_options.js?v=0fb5d3f4"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/translations.js?v=55d7b627"></script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="search" title="Sök" href="../search.html" />
    <link rel="next" title="1. Använda Qgis" href="../interactions/chapter-9.html" />
    <link rel="prev" title="4. Prisvärd och ren energi" href="sdg7-energy.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="../_static/bootstrap-2.3.2/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>

  </head><body>

  <div id="navbar" class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>

        <a class="brand" href="../index.html">
          Workshop FOSS4G Belém</a>
        <span class="navbar-text pull-left"><b>3.0</b></span>

        <div class="nav-collapse">
          <ul class="nav">
            <li class="divider-vertical"></li>
            
                <li><a href="https://docs.pgrouting.org/latest/en/index.html">Documentation</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Chapters <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../general-intro/introduction.html">1. Introduktion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general-intro/osgeolive.html">2. OSGeoLive-installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general-intro/overview.html">3. Översikt över programvara och data</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../basic/data.html">1. Förbereda data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic/pedestrian.html">2. Routning av fotgängare</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic/vehicle.html">3. Routning av fordon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic/graph_views.html">4. Diagramvyer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic/sql_function.html">5. SQL-funktion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic/plpgsql_function.html">6. pl/pgsql-funktion</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="data.html">1. Data för målen för hållbar utveckling</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">2. Uppnå målen för hållbar utveckling med pgRouting</a></li>
<li class="toctree-l1"><a class="reference internal" href="sdg3-health.html">3. God hälsa och välbefinnande</a></li>
<li class="toctree-l1"><a class="reference internal" href="sdg7-energy.html">4. Prisvärd och ren energi</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">5. Hållbara städer och samhällen</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../interactions/chapter-9.html">1. Använda Qgis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interactions/chapter-10.html">2. WMS-server med GeoServer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interactions/chapter-11.html">3. OpenLayers-baserat gränssnitt för routning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/chapter-12.html">4. Skapa en nätverkstopologi</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../examples/boost_dijkstra.html">1. Dijkstra-exempel med Boost</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/hanoslav.html">2. Exempel från internet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/wiki_example.html">3. Dijkstra-exempel från Wikipedia</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../appendix/appendix-2.html">1. Bilaga: Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/appendix-3.html">2. Bilaga: Importverktyg för osm2pgrouting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/appendix-4.html">3. Videohandledningar för workshop</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">5. Hållbara städer och samhällen</a><ul>
<li><a class="reference internal" href="#problem-city-getting-affected-by-rain-or-not">5.1. Problem: Staden påverkas av regn eller inte</a></li>
<li><a class="reference internal" href="#choose-a-city">5.2. Välj en stad</a><ul>
<li><a class="reference internal" href="#exercise-1-create-a-point-for-the-city">5.2.1. Övning 1: Skapa en punkt för staden</a></li>
</ul>
</li>
<li><a class="reference internal" href="#prepare-the-database">5.3. Förbereda databasen</a><ul>
<li><a class="reference internal" href="#exercise-2-set-the-search-path">5.3.1. Övning 2: Ställ in sökvägen</a></li>
<li><a class="reference internal" href="#exercise-3-verify-database-configuration">5.3.2. Övning 3: Verifiera databaskonfigurationen</a><ul>
<li><a class="reference internal" href="#exercise-4-count-the-number-of-waterways">5.3.2.1. Övning 4: Räkna antalet vattenvägar</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#processing-waterways-data">5.4. Bearbetning av vattenvägsdata</a><ul>
<li><a class="reference internal" href="#exercise-5-remove-waterways-not-for-the-problem">5.4.1. Övning 5: Ta bort vattenvägar inte för problemet</a></li>
</ul>
</li>
<li><a class="reference internal" href="#exercise-6-get-the-connected-components-of-waterways">5.5. Övning 6: Få fram de anslutna komponenterna i vattenvägar</a><ul>
<li><a class="reference internal" href="#exercise-7-creating-a-function-that-gets-the-city-buffer">5.5.1. Övning 7: Skapa en funktion som hämtar stadens buffert</a></li>
</ul>
</li>
<li><a class="reference internal" href="#exercise-8-finding-the-components-intersecting-the-buffer">5.6. Övning 8: Hitta de komponenter som skär bufferten</a></li>
<li><a class="reference internal" href="#exercise-9-get-the-rain-zones">5.7. Övning 9: Få fram regnzonerna</a></li>
<li><a class="reference internal" href="#exercise-10-create-a-union-of-rain-zones">5.8. Övning 10: Skapa en sammanslagning av regnzoner</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="sdg7-energy.html" title="Previous Chapter: 4. Prisvärd och ren energi"><span class="icon-chevron-left visible-tablet"></span><span class="hidden-sm hidden-tablet">&laquo; 4. Prisvärd o...</span>
    </a>
  </li>
  <li>
    <a href="../interactions/chapter-9.html" title="Next Chapter: 1. Använda Qgis"><span class="icon-chevron-right visible-tablet"></span><span class="hidden-sm hidden-tablet">1. Använda Qgis &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
      </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body span12 content" role="main">
      
  <section id="sustainable-cities-and-communities">
<h1><a class="toc-backref" href="#id1" role="doc-backlink"><span class="section-number">5. </span>Hållbara städer och samhällen</a><a class="headerlink" href="#sustainable-cities-and-communities" title="Link to this heading">¶</a></h1>
<p><cite>Hållbara städer och samhällen</cite> är det elfte globala målet för hållbar utveckling som syftar till att göra städerna ”inkluderande, säkra, motståndskraftiga” och ”hållbara”.Världen blir alltmer urbaniserad. Sedan 2007 har mer än hälften av världens befolkning bott i städer. Det gör det mycket viktigt för städerna att hålla sig alerta när det finns risk för katastrofer som översvämningar. Den lokala administrationen bör veta om deras stad kommer att påverkas av de regn som inträffar i deras närhet så att de kan höja en varning bland medborgarna. Denna övning kommer att lösa ett av dessa problem.</p>
<img alt="Mål 11 för hållbar utveckling: Hållbara städer och samhällen" class="align-center" src="../_images/un_sdg11.png" />
<p><a class="reference external" href="https://sdgs.un.org/goals/goal11">Bildkälla</a></p>
<nav class="contents" id="chapter-contents">
<p class="topic-title">Kapitelinnehåll</p>
<ul class="simple">
<li><p><a class="reference internal" href="#sustainable-cities-and-communities" id="id1">Hållbara städer och samhällen</a></p>
<ul>
<li><p><a class="reference internal" href="#problem-city-getting-affected-by-rain-or-not" id="id2">Problem: Staden påverkas av regn eller inte</a></p></li>
<li><p><a class="reference internal" href="#choose-a-city" id="id3">Välj en stad</a></p>
<ul>
<li><p><a class="reference internal" href="#exercise-1-create-a-point-for-the-city" id="id4">Övning 1: Skapa en punkt för staden</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#prepare-the-database" id="id5">Förbereda databasen</a></p>
<ul>
<li><p><a class="reference internal" href="#exercise-2-set-the-search-path" id="id6">Övning 2: Ställ in sökvägen</a></p></li>
<li><p><a class="reference internal" href="#exercise-3-verify-database-configuration" id="id7">Övning 3: Verifiera databaskonfigurationen</a></p>
<ul>
<li><p><a class="reference internal" href="#exercise-4-count-the-number-of-waterways" id="id8">Övning 4: Räkna antalet vattenvägar</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#processing-waterways-data" id="id9">Bearbetning av vattenvägsdata</a></p>
<ul>
<li><p><a class="reference internal" href="#exercise-5-remove-waterways-not-for-the-problem" id="id10">Övning 5: Ta bort vattenvägar inte för problemet</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#exercise-6-get-the-connected-components-of-waterways" id="id11">Övning 6: Få fram de anslutna komponenterna i vattenvägar</a></p>
<ul>
<li><p><a class="reference internal" href="#exercise-7-creating-a-function-that-gets-the-city-buffer" id="id12">Övning 7: Skapa en funktion som hämtar stadens buffert</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#exercise-8-finding-the-components-intersecting-the-buffer" id="id13">Övning 8: Hitta de komponenter som skär bufferten</a></p></li>
<li><p><a class="reference internal" href="#exercise-9-get-the-rain-zones" id="id14">Övning 9: Få fram regnzonerna</a></p></li>
<li><p><a class="reference internal" href="#exercise-10-create-a-union-of-rain-zones" id="id15">Övning 10: Skapa en sammanslagning av regnzoner</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="problem-city-getting-affected-by-rain-or-not">
<h2><a class="toc-backref" href="#id2" role="doc-backlink"><span class="section-number">5.1. </span>Problem: Staden påverkas av regn eller inte</a><a class="headerlink" href="#problem-city-getting-affected-by-rain-or-not" title="Link to this heading">¶</a></h2>
<p><strong>Problemformulering</strong></p>
<p>Att fastställa de områden där regn påverkar en stad/ort</p>
<a class="reference internal image-reference" href="../_images/sdg11_output.png"><img alt="../_images/sdg11_output.png" class="align-center" src="../_images/sdg11_output.png" style="width: 413.5px; height: 254.0px;" />
</a>
<p><strong>Kärnidé</strong></p>
<p>Om det regnar i närheten av en flod som förbinder staden kommer staden att påverkas av regnen.</p>
<p><strong>Tillvägagångssätt</strong></p>
<ul class="simple">
<li><p>Välj en stad</p></li>
<li><p>Hämta floderna (kanterna)</p></li>
<li><p>Skapa flodkomponenter</p></li>
<li><p>Skapa en buffert runt staden</p></li>
<li><p>Hitta de komponenter som skär bufferten</p></li>
<li><p>Hitta regnzonerna</p></li>
</ul>
</section>
<section id="choose-a-city">
<h2><a class="toc-backref" href="#id3" role="doc-backlink"><span class="section-number">5.2. </span>Välj en stad</a><a class="headerlink" href="#choose-a-city" title="Link to this heading">¶</a></h2>
<p>För den här övningen har vi valt Munshigang i Bangladesh. Staden har flera floder i sin närhet, vilket gör den till en lämplig plats för att demonstrera denna övning. I övningen försöker man hitta de områden där staden påverkas om det regnar. För att definiera platsen för denna stad och använda den i ytterligare steg skapar du en tabell för att lagra namnet tillsammans med latitud- och longitudvärden för Citys plats. Detta lagrar staden som en punkt.</p>
<section id="exercise-1-create-a-point-for-the-city">
<h3><a class="toc-backref" href="#id4" role="doc-backlink"><span class="section-number">5.2.1. </span>Övning 1: Skapa en punkt för staden</a><a class="headerlink" href="#exercise-1-create-a-point-for-the-city" title="Link to this heading">¶</a></h3>
<p class="rubric">Skapa en tabell för städerna</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">bangladesh</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span>
<span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">  </span><span class="n">geom</span><span class="w"> </span><span class="n">geometry</span><span class="p">,</span>
<span class="w">  </span><span class="n">city_buffer</span><span class="w"> </span><span class="n">geometry</span>
<span class="p">);</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="0b578c30-c981-47b0-8ce4-efe3f4c1ba18" name="0b578c30-c981-47b0-8ce4-efe3f4c1ba18" type="checkbox"><label class="sphinx_collapse__label" for="0b578c30-c981-47b0-8ce4-efe3f4c1ba18"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">TABLE</span>
</pre></div>
</div>
</div>
</div>
<p class="rubric">Infoga Munshigang</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">bangladesh</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">geom</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span>
<span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Munshigang&#39;</span><span class="p">,</span><span class="w">  </span><span class="n">ST_SetSRID</span><span class="p">(</span><span class="n">ST_Point</span><span class="p">(</span><span class="mi">89</span><span class="p">.</span><span class="mi">1967</span><span class="p">,</span><span class="w"> </span><span class="mi">22</span><span class="p">.</span><span class="mi">2675</span><span class="p">),</span><span class="w"> </span><span class="mi">4326</span><span class="p">));</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="e4a17854-f771-48c1-acc6-07e5bd8dcb65" name="e4a17854-f771-48c1-acc6-07e5bd8dcb65" type="checkbox"><label class="sphinx_collapse__label" for="e4a17854-f771-48c1-acc6-07e5bd8dcb65"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INSERT</span> <span class="mi">0</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<p class="rubric">Simulera stadsregionen med en buffert</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span><span class="w"> </span><span class="n">bangladesh</span>
<span class="k">SET</span><span class="w"> </span><span class="n">city_buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ST_Buffer</span><span class="p">((</span><span class="n">geom</span><span class="p">),</span><span class="mi">0</span><span class="p">.</span><span class="mi">005</span><span class="p">)</span>
<span class="k">WHERE</span><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Munshigang&#39;</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="c6f9abaa-afa1-4130-8cff-697c463463e5" name="c6f9abaa-afa1-4130-8cff-697c463463e5" type="checkbox"><label class="sphinx_collapse__label" for="c6f9abaa-afa1-4130-8cff-697c463463e5"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UPDATE</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<p class="rubric">Se beskrivning av tabellen</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">dS</span><span class="o">+</span> <span class="n">bangladesh</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="a8312425-8fe4-44c0-99cc-90a75a76247e" name="a8312425-8fe4-44c0-99cc-90a75a76247e" type="checkbox"><label class="sphinx_collapse__label" for="a8312425-8fe4-44c0-99cc-90a75a76247e"><i class="sphinx_collapse__icon"></i>Command results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                                           <span class="n">Table</span> <span class="s2">&quot;public.bangladesh&quot;</span>
   <span class="n">Column</span>    <span class="o">|</span>   <span class="n">Type</span>   <span class="o">|</span> <span class="n">Collation</span> <span class="o">|</span> <span class="n">Nullable</span> <span class="o">|</span> <span class="n">Default</span> <span class="o">|</span> <span class="n">Storage</span>  <span class="o">|</span> <span class="n">Compression</span> <span class="o">|</span> <span class="n">Stats</span> <span class="n">target</span> <span class="o">|</span> <span class="n">Description</span> 
<span class="o">-------------+----------+-----------+----------+---------+----------+-------------+--------------+-------------</span>
 <span class="nb">id</span>          <span class="o">|</span> <span class="n">bigint</span>   <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">plain</span>    <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
 <span class="n">name</span>        <span class="o">|</span> <span class="n">text</span>     <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">extended</span> <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
 <span class="n">geom</span>        <span class="o">|</span> <span class="n">geometry</span> <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">main</span>     <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
 <span class="n">city_buffer</span> <span class="o">|</span> <span class="n">geometry</span> <span class="o">|</span>           <span class="o">|</span>          <span class="o">|</span>         <span class="o">|</span> <span class="n">main</span>     <span class="o">|</span>             <span class="o">|</span>              <span class="o">|</span> 
<span class="n">Access</span> <span class="n">method</span><span class="p">:</span> <span class="n">heap</span>

</pre></div>
</div>
</div>
</div>
<p>Latitud- och longitudvärden konverteras till geometrisk form med hjälp av <code class="docutils literal notranslate"><span class="pre">ST_Point</span></code> som returnerar en punkt med de angivna X- och Y-koordinatvärdena. <code class="docutils literal notranslate"><span class="pre">ST_SetSRID</span></code> används för att ställa in SRID (Spatial Reference Identifier) på punktgeometrin till <code class="docutils literal notranslate"><span class="pre">4326</span></code>.</p>
</section>
</section>
<section id="prepare-the-database">
<h2><a class="toc-backref" href="#id5" role="doc-backlink"><span class="section-number">5.3. </span>Förbereda databasen</a><a class="headerlink" href="#prepare-the-database" title="Link to this heading">¶</a></h2>
<p>Data som erhållits i <a class="reference internal" href="data.html"><span class="doc">Data för målen för hållbar utveckling</span></a>.</p>
<p>I det här avsnittet behandlas databasens status för att få samma resultat vid bearbetning av frågorna.</p>
<section id="exercise-2-set-the-search-path">
<h3><a class="toc-backref" href="#id6" role="doc-backlink"><span class="section-number">5.3.1. </span>Övning 2: Ställ in sökvägen</a><a class="headerlink" href="#exercise-2-set-the-search-path" title="Link to this heading">¶</a></h3>
<p>Första steget i förbehandlingen är att ställa in sökvägen för <code class="docutils literal notranslate"><span class="pre">Waterways</span></code> data. Sökvägen är en lista med scheman som hjälper systemet att avgöra hur en viss tabell ska importeras.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SET</span><span class="w"> </span><span class="n">search_path</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">waterways</span><span class="p">,</span><span class="k">public</span><span class="p">;</span>
<span class="k">SHOW</span><span class="w"> </span><span class="n">search_path</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="301ff7a6-07a2-41d2-a52f-69238814a8f4" name="301ff7a6-07a2-41d2-a52f-69238814a8f4" type="checkbox"><label class="sphinx_collapse__label" for="301ff7a6-07a2-41d2-a52f-69238814a8f4"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SET</span>
    <span class="n">search_path</span>    
<span class="o">-------------------</span>
 <span class="n">waterways</span><span class="p">,</span> <span class="n">public</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
</section>
<section id="exercise-3-verify-database-configuration">
<h3><a class="toc-backref" href="#id7" role="doc-backlink"><span class="section-number">5.3.2. </span>Övning 3: Verifiera databaskonfigurationen</a><a class="headerlink" href="#exercise-3-verify-database-configuration" title="Link to this heading">¶</a></h3>
<p>Som en del av varje projektuppgift: inspektera databasstrukturen.</p>
<p class="rubric">Hämta de tillägg som är installerade</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">dx</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="f575e65f-eb4a-4811-9d7e-2f2f0825a8f6" name="f575e65f-eb4a-4811-9d7e-2f2f0825a8f6" type="checkbox"><label class="sphinx_collapse__label" for="f575e65f-eb4a-4811-9d7e-2f2f0825a8f6"><i class="sphinx_collapse__icon"></i>Command results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                                 <span class="n">List</span> <span class="n">of</span> <span class="n">installed</span> <span class="n">extensions</span>
   <span class="n">Name</span>    <span class="o">|</span> <span class="n">Version</span> <span class="o">|</span>   <span class="n">Schema</span>   <span class="o">|</span>                        <span class="n">Description</span>                         
<span class="o">-----------+---------+------------+------------------------------------------------------------</span>
 <span class="n">hstore</span>    <span class="o">|</span> <span class="mf">1.8</span>     <span class="o">|</span> <span class="n">public</span>     <span class="o">|</span> <span class="n">data</span> <span class="nb">type</span> <span class="k">for</span> <span class="n">storing</span> <span class="n">sets</span> <span class="n">of</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="n">pairs</span>
 <span class="n">pgrouting</span> <span class="o">|</span> <span class="mf">3.8.0</span>   <span class="o">|</span> <span class="n">public</span>     <span class="o">|</span> <span class="n">pgRouting</span> <span class="n">Extension</span>
 <span class="n">plpgsql</span>   <span class="o">|</span> <span class="mf">1.0</span>     <span class="o">|</span> <span class="n">pg_catalog</span> <span class="o">|</span> <span class="n">PL</span><span class="o">/</span><span class="n">pgSQL</span> <span class="n">procedural</span> <span class="n">language</span>
 <span class="n">postgis</span>   <span class="o">|</span> <span class="mf">3.5.3</span>   <span class="o">|</span> <span class="n">public</span>     <span class="o">|</span> <span class="n">PostGIS</span> <span class="n">geometry</span> <span class="ow">and</span> <span class="n">geography</span> <span class="n">spatial</span> <span class="n">types</span> <span class="ow">and</span> <span class="n">functions</span>
<span class="p">(</span><span class="mi">4</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
<p class="rubric">Lista installerade tabeller</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>\<span class="n">dt</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="4369ea51-1144-490d-bd32-cb30db432eb2" name="4369ea51-1144-490d-bd32-cb30db432eb2" type="checkbox"><label class="sphinx_collapse__label" for="4369ea51-1144-490d-bd32-cb30db432eb2"><i class="sphinx_collapse__icon"></i>Command results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                    <span class="n">List</span> <span class="n">of</span> <span class="n">relations</span>
  <span class="n">Schema</span>   <span class="o">|</span>            <span class="n">Name</span>             <span class="o">|</span> <span class="n">Type</span>  <span class="o">|</span> <span class="n">Owner</span>  
<span class="o">-----------+-----------------------------+-------+--------</span>
 <span class="n">public</span>    <span class="o">|</span> <span class="n">bangladesh</span>                  <span class="o">|</span> <span class="n">table</span> <span class="o">|</span> <span class="n">runner</span>
 <span class="n">public</span>    <span class="o">|</span> <span class="n">spatial_ref_sys</span>             <span class="o">|</span> <span class="n">table</span> <span class="o">|</span> <span class="n">runner</span>
 <span class="n">waterways</span> <span class="o">|</span> <span class="n">configuration</span>               <span class="o">|</span> <span class="n">table</span> <span class="o">|</span> <span class="n">user</span>
 <span class="n">waterways</span> <span class="o">|</span> <span class="n">waterways_pointsofinterest</span>  <span class="o">|</span> <span class="n">table</span> <span class="o">|</span> <span class="n">user</span>
 <span class="n">waterways</span> <span class="o">|</span> <span class="n">waterways_ways</span>              <span class="o">|</span> <span class="n">table</span> <span class="o">|</span> <span class="n">user</span>
 <span class="n">waterways</span> <span class="o">|</span> <span class="n">waterways_ways_vertices_pgr</span> <span class="o">|</span> <span class="n">table</span> <span class="o">|</span> <span class="n">user</span>
<span class="p">(</span><span class="mi">6</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
<section id="exercise-4-count-the-number-of-waterways">
<h4><a class="toc-backref" href="#id8" role="doc-backlink"><span class="section-number">5.3.2.1. </span>Övning 4: Räkna antalet vattenvägar</a><a class="headerlink" href="#exercise-4-count-the-number-of-waterways" title="Link to this heading">¶</a></h4>
<p>Vikten av att räkna informationen i denna workshop är att säkerställa att samma data används och att resultaten följaktligen blir desamma. Dessutom kan man se några av raderna för att förstå tabellens struktur och hur uppgifterna lagras i den.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">waterways_ways</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="f04ecb87-dcb7-4b10-a15a-9afc4722b80b" name="f04ecb87-dcb7-4b10-a15a-9afc4722b80b" type="checkbox"><label class="sphinx_collapse__label" for="f04ecb87-dcb7-4b10-a15a-9afc4722b80b"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">count</span> 
<span class="o">-------</span>
   <span class="mi">815</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="processing-waterways-data">
<h2><a class="toc-backref" href="#id9" role="doc-backlink"><span class="section-number">5.4. </span>Bearbetning av vattenvägsdata</a><a class="headerlink" href="#processing-waterways-data" title="Link to this heading">¶</a></h2>
<p>I detta avsnitt bearbetas den graf som ska användas för bearbetning. När grafen byggs upp måste data inspekteras för att avgöra om det finns några ogiltiga data. Detta är ett mycket viktigt steg för att säkerställa att data håller erforderlig kvalitet. pgRouting kan också användas för att göra vissa datajusteringar.</p>
<section id="exercise-5-remove-waterways-not-for-the-problem">
<h3><a class="toc-backref" href="#id10" role="doc-backlink"><span class="section-number">5.4.1. </span>Övning 5: Ta bort vattenvägar inte för problemet</a><a class="headerlink" href="#exercise-5-remove-waterways-not-for-the-problem" title="Link to this heading">¶</a></h3>
<img alt="Vattenvägar ska tas bort" class="align-center" src="../_images/remove_waterways.png" />
<p>Denna övning fokuserar endast på de områden på fastlandet där staden påverkas om det regnar. Därför ska de floder som finns i träskområdet, som ligger lägre upp i staden, tas bort från tabellen <code class="docutils literal notranslate"><span class="pre">waterways_ways</span></code>.</p>
<p class="rubric">Ta bort träskfloder</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">waterways_ways</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">osm_id</span>
<span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="mi">721133202</span><span class="p">,</span><span class="w"> </span><span class="mi">908102930</span><span class="p">,</span><span class="w"> </span><span class="mi">749173392</span><span class="p">,</span><span class="w"> </span><span class="mi">652172284</span><span class="p">,</span><span class="w"> </span><span class="mi">126774195</span><span class="p">,</span><span class="w"> </span><span class="mi">720395312</span><span class="p">);</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="f261957c-2b97-4073-b134-0b1749b2992a" name="f261957c-2b97-4073-b134-0b1749b2992a" type="checkbox"><label class="sphinx_collapse__label" for="f261957c-2b97-4073-b134-0b1749b2992a"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DELETE</span> <span class="mi">31</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Observera</p>
<p>När man arbetar för många städer kan det vara bättre att skapa vyer.</p>
</div>
<p class="rubric">Ta även bort en gräns som taggats som vattenväg</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">waterways_ways</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">osm_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">815893446</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="469d020a-1403-4814-9cd1-583fd4d8ede6" name="469d020a-1403-4814-9cd1-583fd4d8ede6" type="checkbox"><label class="sphinx_collapse__label" for="469d020a-1403-4814-9cd1-583fd4d8ede6"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DELETE</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Observera</p>
<p>Ett bättre tillvägagångssätt kan vara att fixa originaldata på OSM-webbplatsen.</p>
</div>
</section>
</section>
<section id="exercise-6-get-the-connected-components-of-waterways">
<h2><a class="toc-backref" href="#id11" role="doc-backlink"><span class="section-number">5.5. </span>Övning 6: Få fram de anslutna komponenterna i vattenvägar</a><a class="headerlink" href="#exercise-6-get-the-connected-components-of-waterways" title="Link to this heading">¶</a></h2>
<p>Eftersom floderna i data inte har en enda kant, dvs. flera kanter utgör en flod, är det viktigt att ta reda på de anslutna kanterna och lagra informationen i tabellen <code class="docutils literal notranslate"><span class="pre">waterways_ways</span></code>. Detta kommer att hjälpa oss att identifiera vilka kanter som tillhör en flod. Först hittas de anslutna komponenterna och lagras sedan i en ny kolumn med namnet <code class="docutils literal notranslate"><span class="pre">component</span></code>.</p>
<p>PgRouting-funktionen <code class="docutils literal notranslate"><span class="pre">pgr_connectedComponents</span></code> används för att slutföra denna uppgift och förklaras mer detaljerat i <a class="reference internal" href="../basic/graph_views.html"><span class="doc">Diagramvyer</span></a>.</p>
<p>En underfråga skapas för att ta reda på alla anslutna komponenter. Därefter uppdateras kolumnen <code class="docutils literal notranslate"><span class="pre">component</span></code> med hjälp av de resultat som erhållits från underfrågan. Detta hjälper till att lagra komponent-ID i tabellen <code class="docutils literal notranslate"><span class="pre">waterways_ways_vertices_pgr</span></code>. Nästa fråga använder detta resultat och lagrar komponentens ID i tabellen waterways_ways (edges). Följ stegen nedan för att slutföra den här uppgiften.</p>
<p class="rubric">Skapa en vertices-tabell.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">waterways</span><span class="p">.</span><span class="n">waterways_vertices</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">pgr_extractVertices</span><span class="p">(</span>
<span class="w">  </span><span class="s1">&#39;SELECT gid AS id, source, target</span>
<span class="s1">  FROM waterways.waterways_ways ORDER BY id&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="4c748bdf-16a5-4ecb-83a2-16b90a20362a" name="4c748bdf-16a5-4ecb-83a2-16b90a20362a" type="checkbox"><label class="sphinx_collapse__label" for="4c748bdf-16a5-4ecb-83a2-16b90a20362a"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="mi">777</span>
</pre></div>
</div>
</div>
</div>
<p class="rubric">Fyll i kolumnerna <code class="docutils literal notranslate"><span class="pre">x</span></code>, <code class="docutils literal notranslate"><span class="pre">y</span></code> och <code class="docutils literal notranslate"><span class="pre">geom</span></code>.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span><span class="w"> </span><span class="n">waterways_vertices</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">geom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ST_startPoint</span><span class="p">(</span><span class="n">the_geom</span><span class="p">)</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">waterways_ways</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>

<span class="k">UPDATE</span><span class="w"> </span><span class="n">waterways_vertices</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">geom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ST_endPoint</span><span class="p">(</span><span class="n">the_geom</span><span class="p">)</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">waterways_ways</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">geom</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>

<span class="k">UPDATE</span><span class="w"> </span><span class="n">waterways_vertices</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ST_X</span><span class="p">(</span><span class="n">geom</span><span class="p">),</span><span class="w"> </span><span class="n">ST_Y</span><span class="p">(</span><span class="n">geom</span><span class="p">));</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="e931bff2-ed41-41e5-9a51-b84202afd82b" name="e931bff2-ed41-41e5-9a51-b84202afd82b" type="checkbox"><label class="sphinx_collapse__label" for="e931bff2-ed41-41e5-9a51-b84202afd82b"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UPDATE</span> <span class="mi">656</span>
<span class="n">UPDATE</span> <span class="mi">121</span>
<span class="n">UPDATE</span> <span class="mi">777</span>
</pre></div>
</div>
</div>
</div>
<p class="rubric">Lägg till en <code class="docutils literal notranslate"><span class="pre">component</span></code>-kolumn i tabellerna edges och vertices.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">waterways_ways</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">;</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">waterways_vertices</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="ec4dd204-6448-48d9-8bbe-de948ce6756a" name="ec4dd204-6448-48d9-8bbe-de948ce6756a" type="checkbox"><label class="sphinx_collapse__label" for="ec4dd204-6448-48d9-8bbe-de948ce6756a"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ALTER</span> <span class="n">TABLE</span>
<span class="n">ALTER</span> <span class="n">TABLE</span>
</pre></div>
</div>
</div>
</div>
<p class="rubric">Fyll i kolumnen <code class="docutils literal notranslate"><span class="pre">component</span></code> i tabellen över vertikaler.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span><span class="w"> </span><span class="n">waterways_vertices</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">component</span>
<span class="k">FROM</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">pgr_connectedComponents</span><span class="p">(</span>
<span class="w">  </span><span class="s1">&#39;SELECT gid as id, source, target, cost, reverse_cost FROM waterways_ways&#39;</span><span class="p">)</span>
<span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">c</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="00be28bf-c671-4405-bc2d-502122a19fb7" name="00be28bf-c671-4405-bc2d-502122a19fb7" type="checkbox"><label class="sphinx_collapse__label" for="00be28bf-c671-4405-bc2d-502122a19fb7"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UPDATE</span> <span class="mi">777</span>
</pre></div>
</div>
</div>
</div>
<p class="rubric">Fyll i kolumnen <code class="docutils literal notranslate"><span class="pre">component</span></code> i tabellen över kanter.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span><span class="w"> </span><span class="n">waterways_ways</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">component</span>
<span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">waterways_vertices</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">v</span>
<span class="k">WHERE</span><span class="w"> </span><span class="k">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">id</span><span class="p">;</span>
</pre></div>
</div>
<section id="exercise-7-creating-a-function-that-gets-the-city-buffer">
<h3><a class="toc-backref" href="#id12" role="doc-backlink"><span class="section-number">5.5.1. </span>Övning 7: Skapa en funktion som hämtar stadens buffert</a><a class="headerlink" href="#exercise-7-creating-a-function-that-gets-the-city-buffer" title="Link to this heading">¶</a></h3>
<p>En funktion kan skapas för samma uppgift. Detta är till hjälp när tabellen har mer än en stad.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">get_city_buffer</span><span class="p">(</span><span class="n">city_id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="p">)</span>
<span class="k">RETURNS</span><span class="w"> </span><span class="n">geometry</span><span class="w"> </span><span class="k">AS</span>
<span class="err">$</span><span class="n">BODY$</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">city_buffer</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">bangladesh</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">city_id</span><span class="p">;</span>
<span class="err">$</span><span class="n">BODY$</span>
<span class="k">LANGUAGE</span><span class="w"> </span><span class="k">SQL</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="c0c2e94f-338c-4ae8-8266-a7018764d090" name="c0c2e94f-338c-4ae8-8266-a7018764d090" type="checkbox"><label class="sphinx_collapse__label" for="c0c2e94f-338c-4ae8-8266-a7018764d090"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">FUNCTION</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="exercise-8-finding-the-components-intersecting-the-buffer">
<h2><a class="toc-backref" href="#id13" role="doc-backlink"><span class="section-number">5.6. </span>Övning 8: Hitta de komponenter som skär bufferten</a><a class="headerlink" href="#exercise-8-finding-the-components-intersecting-the-buffer" title="Link to this heading">¶</a></h2>
<p>Nästa steg är att hitta de delar av vattenvägarna som ligger i stadens buffertzon. Det är dessa vattenvägar som kommer att påverka staden när det regnar runt dem. Detta görs med hjälp av <code class="docutils literal notranslate"><span class="pre">ST_Intersects</span></code>. Observera att funktionen <code class="docutils literal notranslate"><span class="pre">get_city_buffer</span></code> används i frågan nedan.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">component</span>
<span class="linenos">2</span><span class="k">FROM</span><span class="w"> </span><span class="n">bangladesh</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">waterways</span><span class="p">.</span><span class="n">waterways_ways</span>
<span class="linenos">3</span><span class="k">ON</span><span class="w"> </span><span class="p">(</span><span class="n">ST_Intersects</span><span class="p">(</span><span class="n">the_geom</span><span class="p">,</span><span class="w"> </span><span class="n">get_city_buffer</span><span class="p">(</span><span class="mi">5</span><span class="p">)));</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="16faa48b-61c8-40fa-8869-8eb8f908bc8a" name="16faa48b-61c8-40fa-8869-8eb8f908bc8a" type="checkbox"><label class="sphinx_collapse__label" for="16faa48b-61c8-40fa-8869-8eb8f908bc8a"><i class="sphinx_collapse__icon"></i>Command result</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">component</span> 
<span class="o">-----------</span>
         <span class="mi">8</span>
        <span class="mi">57</span>
        <span class="mi">62</span>
<span class="p">(</span><span class="mi">3</span> <span class="n">rows</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
<p>Output visar de distinkta komponentnummer som ligger i stadens buffertzon. Det vill säga de floder som ligger inom staden.</p>
</section>
<section id="exercise-9-get-the-rain-zones">
<h2><a class="toc-backref" href="#id14" role="doc-backlink"><span class="section-number">5.7. </span>Övning 9: Få fram regnzonerna</a><a class="headerlink" href="#exercise-9-get-the-rain-zones" title="Link to this heading">¶</a></h2>
<p>I den här övningen beräknas det område där staden skulle påverkas om det regnar. Detta område kallas <code class="docutils literal notranslate"><span class="pre">regnzon</span></code> i övningen</p>
<p>Skapa en buffert runt flodkomponenterna.</p>
<ul class="simple">
<li><p>Lägg till kolumner med namnet <code class="docutils literal notranslate"><span class="pre">rain_zone</span></code> i waterways_ways</p>
<ul>
<li><p>För att lagra buffertgeometrin för regnzonerna.</p></li>
</ul>
</li>
<li><p>Hitta bufferten för varje kant som korsar stadens buffertområde med hjälp av <code class="docutils literal notranslate"><span class="pre">ST_Buffer</span></code></p></li>
<li><p>och uppdatera kolumnen <code class="docutils literal notranslate"><span class="pre">rain_zone</span></code>.</p></li>
</ul>
<p class="rubric">Lägga till kolumn för att lagra buffertgeometri</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">waterways_ways</span>
<span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">rain_zone</span><span class="w"> </span><span class="n">geometry</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="87273bed-316d-40e2-91ed-4ce95845aaeb" name="87273bed-316d-40e2-91ed-4ce95845aaeb" type="checkbox"><label class="sphinx_collapse__label" for="87273bed-316d-40e2-91ed-4ce95845aaeb"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ALTER</span> <span class="n">TABLE</span>
</pre></div>
</div>
</div>
</div>
<p class="rubric">Lagring av buffertgeometri</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">UPDATE</span><span class="w"> </span><span class="n">waterways</span><span class="p">.</span><span class="n">waterways_ways</span>
<span class="k">SET</span><span class="w"> </span><span class="n">rain_zone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ST_Buffer</span><span class="p">((</span><span class="n">the_geom</span><span class="p">),</span><span class="mi">0</span><span class="p">.</span><span class="mi">005</span><span class="p">)</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">ST_Intersects</span><span class="p">(</span><span class="n">the_geom</span><span class="p">,</span><span class="w"> </span><span class="n">get_city_buffer</span><span class="p">(</span><span class="mi">5</span><span class="p">));</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="fbcc3daa-ddd7-4767-96a4-cdfecaa95129" name="fbcc3daa-ddd7-4767-96a4-cdfecaa95129" type="checkbox"><label class="sphinx_collapse__label" for="fbcc3daa-ddd7-4767-96a4-cdfecaa95129"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UPDATE</span> <span class="mi">5</span>
</pre></div>
</div>
</div>
</div>
<p>Detta kommer att ge oss det nödvändiga området, där staden kommer att påverkas om det regnar.</p>
</section>
<section id="exercise-10-create-a-union-of-rain-zones">
<h2><a class="toc-backref" href="#id15" role="doc-backlink"><span class="section-number">5.8. </span>Övning 10: Skapa en sammanslagning av regnzoner</a><a class="headerlink" href="#exercise-10-create-a-union-of-rain-zones" title="Link to this heading">¶</a></h2>
<p>Flera polygoner som erhålls kan också slås samman med hjälp av <code class="docutils literal notranslate"><span class="pre">ST_Union</span></code>. Detta kommer att ge en enda polygon som utdata.</p>
<a class="reference internal image-reference" href="../_images/sdg11_output.png"><img alt="../_images/sdg11_output.png" class="align-center" src="../_images/sdg11_output.png" style="width: 413.5px; height: 254.0px;" />
</a>
<p>När det regnar i närområdet kommer staden att påverkas av regnet.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Combining mutliple rain zones</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">ST_Union</span><span class="p">(</span><span class="n">rain_zone</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">Combined_Rain_Zone</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">waterways_ways</span><span class="p">;</span>
</pre></div>
</div>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="fe071db3-9fde-4a93-a9de-7c3a7ae02454" name="fe071db3-9fde-4a93-a9de-7c3a7ae02454" type="checkbox"><label class="sphinx_collapse__label" for="fe071db3-9fde-4a93-a9de-7c3a7ae02454"><i class="sphinx_collapse__icon"></i>Query results</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         <span class="n">combined_rain_zone</span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
<span class="o">--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
 <span class="mf">0103000020E6100000010000007</span><span class="n">C0000005DC25946634C56408ABF87BDBD423640C1A237A6584C5640303DDDE7ED423640249BBB93504C56408102F66F25433640F39C4F5E4B4C56401601813362433640BDC63139494C56409AC7B3DCA1433640FB447C394A4C5640E98843F9E14336400968C5394A4C564015E594FDE14336405F1DD849404C56403A5577EED7433640ACA22AF92F4C564083775044CE433640D1D14BCE164C5640F1C9219DC94336400CF50F290A4C56405E7E1330CB433640F3418FC4F44B5640AC581E80D4433640E509D39DEE4B5640C765B120D8433640CA514196DF4B56404EC10A56E3433640066B34B9D04B5640610AF3DFEA4336402FC1DF4DC54B564085CAD719ED433640C9591B3ABF4B5640F1E5EA48EE43364011DAB3B9AA4B56401E9B1316E9433640BE268DB4A24B564099AAB1BFE4433640AC3A89729B4B564051CAA489DE433640C9676CB4874B5640BA0527F0C74336401D40D2D86E4B5640F5AA9FCDA743364014C5557C604B564048EB3A3E924336401B7C4CF8504B56404624C5AC814336407E94B7F1404B5640EA8B6E887D43364041FE3F06314B56408EACF6F9854336402BE983D2214B564021834CAE9A433640B4F811EC134B564006B3BFD9BA43364084EEA9DB074B5640F666D43FE54336405A56FB17FE4A5640FADC6C3F18443640ABE61501F74A564095F6D0E251443640EB74B8DCF24A5640761AF6F28F443640D4CEA2D3F14A5640EBB8490DD0443640FDD604F0F34A5640DF1128BB0F453640A24C1A1DF94A56403866188A4C4536409B18F727014B56401328E0238445364097457CC10B4B5640D4508065B445364018636281184B56407BB13A74DB4536407E693BEA264B56403670D0CFF7453640343BE10E374B56402A58070C104636405459A9A63A4B56400C80311015463640C281CAA3564B5640BDF1E43E3946364078E51B4B594B564073FD897A3C463640F5CA020C714B5640D1EB67AB57463640B85E8172764B564048DC8A105D463640A6DC2B7D834B56407ECAB339684636407F5FBFA6894B564018D4AA856C463640EFA1E0A8974B5640430C1D19744636402951FB739D4B5640218571657646364062D98771B94B56406B7A6A7E7D4636409400739CC24B5640490E28C37D463640358E8546CD4B5640AF9751AF7B463640752D47DEDB4B564073A90BD7784636405D4B742FE24B5640717C28A0764636403B00E98FF64B5640BE24644A6C463640E5FE8A45FB4B56405FEEBE57694636408B333996094C56408A85C9AA5E46364028093C94154C56408EFB5772594636402DD4F420204C5640FED3A9655B463640F01C7BFF234C564029EF54505F46364060D541A42D4C5640C6ACEE726B46364038A83343404C5640D1063783864636407C91432C444C564062D10EC18B463640F1E3EC4F554C5640B6CDEED2A046364056D33CEC574C564026C237D8A34636406B23E593674C56403BC78CD6B4463640CB6FC0B6784C5640ECFC01D2BF46364068083B0B8A4C5640D239E01DBC4636401329E60B8E4C5640D902888AB9463640EE58623E9D4C5640D0F651A9A9463640D6996367AB4C56403533C3788E463640A35FA501B84C56406FA6C0F868463640B115469BB94C5640CDE9CF2D63463640FEDD7DE9BA4C564001298A6D60463640D2EE2B65BF4C56406C47E19954463640060C5C59C34C56408751C0984B463640FECDFD33CD4C564065D752343146364061FA2B1DD14C56404EEE67002546364042FC43BFDC4C5640A8D0CEB7F8453640379138FFE54C56402FDB0C35C4453640CFED0982EC4C5640AC0CBB7C89453640D205AA07F04C5640366688D04A453640B3F8C816F04C564075054D4641453640ADC20E1FF44C564009C0211D39453640A1783163FA4C564095CBB6B83F453640EE5D946A0A4D5640BF8101AA43453640DEA158541A4D564016D8C7053B45364054CFF083294D5640D3890D21264536401EFEF663374D56408C085FC905453640C097EA6B434D56409B4FEB3CDB4436401B3E6F254D4D5640349F491EA84436407C38D930544D56407C6A63646E443640A5A7DA48584D5640FDB920473044364030552D45594D5640C7249529F0433640C5EA1E1C574D564007158482B0433640F0E231EB554D56409B1855719C4336406FB56626504D56408BED70085B433640B04D9011474D56409DC508F21F4336408DDF41EC434D56409FE8DCA30F4336403A7F09153B4D5640A3D8D3B8E84236404163826B394D564059E12B6DE3423640223BE9713A4D56404CCC6847CE42364076D4BABE3B4D56404370292C794236402F6D104D3B4D5640142EC2A35F4236409B072C9F384D5640DB07B14D20423640453BA8E7324D5640C2BF6A46E441364073FFC25E2A4D5640EB9A7DDCAD413640F33073581F4D564031543B277F413640FF882E41124D564052AC26F259413640D197BE99034D5640B5C64AAB3F4136402DC44DF2F34C5640910C2A55314136408E00DDE4E34C5640E7F9CE7C2F41364000B7580FD44C5640389060343A413640F924870DC54C564091C16F1251413640C4DB0B73B74C5640D7B0043673413640154ABBC5AB4C5640D6EA434F9F4136401D207678A24C5640A98A56ACD341364030D41C0D9C4C56406499C0F30C423640F5D774EB904C564041E0C04F29423640F15AF7E28B4C5640153E3F9C39423640E251EE19814C5640FFDB62A963423640323E840C7D4C5640CECF25AB764236405F7A990B704C56403494CECA964236405DC25946634C56408ABF87BDBD423640</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2010-2024 pgRouting Developers.<br/>
      Senast uppdaterad juli 07, 2025.<br/>
    </p>
  </div>
</footer>
  </body>
</html>